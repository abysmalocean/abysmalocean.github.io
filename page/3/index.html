<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="alternate" href="/atom.xml" title="Liang Xu" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":5,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="This is the place for Liang to make any notes if he feels like it">
<meta property="og:type" content="website">
<meta property="og:title" content="Liang Xu">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;page&#x2F;3&#x2F;index.html">
<meta property="og:site_name" content="Liang Xu">
<meta property="og:description" content="This is the place for Liang to make any notes if he feels like it">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Liang Xu</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Liang Xu</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Liang Xu is a Computer Science guy</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/yourname" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/18/01-TwoSUM-LeetCode-100/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liang Xu">
      <meta itemprop="description" content="This is the place for Liang to make any notes if he feels like it">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liang Xu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/18/01-TwoSUM-LeetCode-100/" class="post-title-link" itemprop="url">01_TwoSUM_LeetCode_100</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-18 13:01:00" itemprop="dateCreated datePublished" datetime="2019-12-18T13:01:00-05:00">2019-12-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Two-Sum"><a class="header-anchor" href="#Two-Sum"></a>Two Sum</h1>
<blockquote>
<p>easy</p>
</blockquote>
<p>Given an array of integers, return indices of the two numbers such that they add up to a specific target.</p>
<p>You may assume that each input would have<br>
exactly one solution, and you may not use the same element twice.</p>
<p align = "center"> <img width = "500" src = "images/01_Two_sum_2019-12-18-12-20-58.png "> </p>
<h2 id="My-Solution"><a class="header-anchor" href="#My-Solution"></a>My Solution</h2>
<p>This is a Hash table and scans the array.<br>
Hash table keep the record [target-nums[i], i];</p>
<blockquote>
<p>runtime 8 ms<br>
memory : 10.1 MB</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; twoSum(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(nums.size() &lt; <span class="number">2</span>) <span class="keyword">return</span> &#123;<span class="number">-1</span>,<span class="number">-1</span>&#125;; </span><br><span class="line">        </span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; <span class="built_in">map</span>; </span><br><span class="line">        <span class="built_in">map</span>[target-nums[<span class="number">0</span>]] = <span class="number">0</span>; </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; nums.size(); ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">map</span>.count(nums[i]) &gt; <span class="number">0</span>) <span class="keyword">return</span> &#123;<span class="built_in">map</span>[nums[i]], i&#125;; </span><br><span class="line">            <span class="built_in">map</span>[target-nums[i]] = i; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="number">-1</span>,<span class="number">-1</span>&#125;; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Time: O(n), just one scan, however, if you have a bad hash table, this turns too($n^2$)<br>
Space O(n), the hash table needs to take one additional space.</p>
</blockquote>
<h2 id="C-language-things"><a class="header-anchor" href="#C-language-things"></a>C++ language things</h2>
<blockquote>
<p>find a key is the unordered_map using <code>map.count(key) &gt; 0</code>;<br>
this is very important, will use it in the future.</p>
</blockquote>
<h2 id="Other-Methods"><a class="header-anchor" href="#Other-Methods"></a>Other Methods</h2>
<h3 id="Approach-1-Brute-Force"><a class="header-anchor" href="#Approach-1-Brute-Force"></a>Approach 1, Brute Force.</h3>
<p>This a very natural idea, and also very simple. A loop through element x and find if there is another value that equals to target - x.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; twoSum(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.size() &lt; <span class="number">2</span>) <span class="keyword">return</span>&#123;<span class="number">-1</span>,<span class="number">-1</span>&#125;; </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.size(); ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; nums.size(); ++j)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[i] + nums[j] == target)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> &#123;i, j&#125;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="number">-1</span>, <span class="number">-1</span>&#125;; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Runtime 140 ms<br>
Memory : 9.2 MB</p>
</blockquote>
<p>However, this method seems time-consuming, However, in terms of space, it wins.</p>
<blockquote>
<p>Time O(n^2): need to scan the array for each element;<br>
Space O(1): No need for additional space.</p>
</blockquote>
<h3 id="Approach-2-Two-pass-Hash-Table"><a class="header-anchor" href="#Approach-2-Two-pass-Hash-Table"></a>Approach 2: Two-pass Hash Table</h3>
<p>For approach 1, the time-consuming part is the inner loop. It require O(n) for search the ‘whole array’ (not whole, starting from [i, len]);</p>
<p>Idea is to use a hash table help to find the elements;</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; twoSum(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.size() &lt; <span class="number">2</span>) <span class="keyword">return</span> &#123;<span class="number">-1</span>, <span class="number">-1</span>&#125;; </span><br><span class="line">        </span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; <span class="built_in">map</span>; </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.size(); ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            if(map.count(nums[i]) &gt; 0  &amp;&amp; nums[i] * 2 == target)</span></span><br><span class="line"><span class="comment">            &#123;</span></span><br><span class="line"><span class="comment">                return &#123;map[nums[i]], i&#125;;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="built_in">map</span>[target - nums[i]] = i; </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.size(); ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">map</span>.count(nums[i]) &gt; <span class="number">0</span> &amp;&amp; <span class="built_in">map</span>[nums[i]] != i)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="built_in">map</span>[nums[i]], i&#125;; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="number">-1</span>, <span class="number">-1</span> &#125;; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>This is more interesting compared with my solution in terms of analysis.</p>
<ol>
<li>scan the array and add the [target - x, i]</li>
<li>scan the array the second time and find the nums[i] is in the map and find the index.</li>
</ol>
<p>Because the question tells us, there is exactly one solution, and can not use the same number twice.<br>
In the beginning, I was thinking to find the same elements which the element * 2 == target.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">map</span>.count(nums[i]) &gt; <span class="number">0</span> &amp;&amp; nums[i] * <span class="number">2</span> == target)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="built_in">map</span>[nums[i]], i&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And this part is comment out. It is not necessary.</p>
<ol>
<li>If there are two same elements and they added to the target. When scanning the array in the second time, the first element will find the second index in the map, because they map to a different index.</li>
<li>if there one element and *2 == target. The index is the same in this case.</li>
</ol>
<p>So we only need to check if the element has the same index or not in the second scan.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/13/c-Continer-CPP-05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liang Xu">
      <meta itemprop="description" content="This is the place for Liang to make any notes if he feels like it">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liang Xu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/13/c-Continer-CPP-05/" class="post-title-link" itemprop="url">CPP_05 Container_01</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-13 00:37:27" itemprop="dateCreated datePublished" datetime="2019-12-13T00:37:27-05:00">2019-12-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This post will talk about the container.</p>
<h2 id="String"><a class="header-anchor" href="#String"></a>String</h2>
<p>members:</p>
<ul>
<li>begin</li>
<li>end</li>
<li>empty</li>
<li>size</li>
<li>swap</li>
</ul>
<p align = "center"> <img width = "500" src = "images/04_container_2019-12-12-22-31-16.png "> </p>
<p>Because string needs to compatible with C language, so begin point to the beginning of the char array, and end pointed to the “\0” this is a bit different compared with the normal container. For most of the cast, end() will point a space.</p>
<ul>
<li>support + += operation</li>
<li>find</li>
<li>support <code>istream</code>(getline)</li>
<li>support api who has const char* interface(c_str)</li>
<li>to numbers <code>stoi</code> and <code>to_string</code></li>
</ul>
<blockquote>
<p><strong>stoi</strong><br>
Convert string to integer<br>
int stoi (const string&amp; str, size_t* idx = 0, int base = 10);<br>
<code>str</code>: String object with the representation of an integral number.<br>
<code>idx</code>: Pointer to an object of type size_t, whose value is set by the function to position of the next character in str after the numerical value.</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stoi example</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt; // std::cout</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt; // std::string, std::stoi</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="built_in">std</span>::<span class="built_in">string</span> str_dec = <span class="string">"2001, A Space Odyssey"</span>;</span><br><span class="line"> <span class="built_in">std</span>::<span class="built_in">string</span> str_hex = <span class="string">"40c3"</span>;</span><br><span class="line"> <span class="built_in">std</span>::<span class="built_in">string</span> str_bin = <span class="string">"-10010110001"</span>;</span><br><span class="line"> <span class="built_in">std</span>::<span class="built_in">string</span> str_auto = <span class="string">"0x7f"</span>;</span><br><span class="line"></span><br><span class="line"> <span class="built_in">std</span>::<span class="built_in">string</span>::size_type sz; <span class="comment">// alias of size_t</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">int</span> i_dec = <span class="built_in">std</span>::stoi (str_dec,&amp;sz);</span><br><span class="line"> <span class="keyword">int</span> i_hex = <span class="built_in">std</span>::stoi (str_hex,<span class="literal">nullptr</span>,<span class="number">16</span>);</span><br><span class="line"> <span class="keyword">int</span> i_bin = <span class="built_in">std</span>::stoi (str_bin,<span class="literal">nullptr</span>,<span class="number">2</span>);</span><br><span class="line"> <span class="keyword">int</span> i_auto = <span class="built_in">std</span>::stoi (str_auto,<span class="literal">nullptr</span>,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"> <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; str_dec &lt;&lt; <span class="string">": "</span> &lt;&lt; i_dec &lt;&lt; <span class="string">" and ["</span> &lt;&lt; str_dec.substr(sz) &lt;&lt; <span class="string">"]\n"</span>;</span><br><span class="line"> <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; str_hex &lt;&lt; <span class="string">": "</span> &lt;&lt; i_hex &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line"> <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; str_bin &lt;&lt; <span class="string">": "</span> &lt;&lt; i_bin &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line"> <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; str_auto &lt;&lt; <span class="string">": "</span> &lt;&lt; i_auto &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2001, A Space Odyssey: 2001 and [, A Space Odyssey]</span><br><span class="line">40c3: 16579</span><br><span class="line">-10010110001: -1201</span><br><span class="line">0x7f: 127</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">to_string</span> <span class="params">(<span class="keyword">int</span> val)</span></span>;</span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">to_string</span> <span class="params">(<span class="keyword">long</span> val)</span></span>;</span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">to_string</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> val)</span></span>;</span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">to_string</span> <span class="params">(<span class="keyword">unsigned</span> val)</span></span>;</span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">to_string</span> <span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> val)</span></span>;</span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">to_string</span> <span class="params">(<span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> val)</span></span>;</span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">to_string</span> <span class="params">(<span class="keyword">float</span> val)</span></span>;</span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">to_string</span> <span class="params">(<span class="keyword">double</span> val)</span></span>;</span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">to_string</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">double</span> val)</span></span>;</span><br></pre></td></tr></table></figure>
<p>Not recommaned to use as a interface. for example</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">getChar</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; inString)</span></span>; </span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">getChar</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* inString)</span></span>;</span><br></pre></td></tr></table></figure>
<p>Simple program</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> name;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"What's your name? "</span>;</span><br><span class="line">getline(<span class="built_in">cin</span>, name);</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"Nice to meet you, "</span> &lt;&lt; name</span><br><span class="line"> &lt;&lt; <span class="string">"!\n"</span>;</span><br></pre></td></tr></table></figure>
<h2 id="Vector"><a class="header-anchor" href="#Vector"></a>Vector</h2>
<p>std::vector probability the most popular container.</p>
<p align = "center"> <img width = "500" src = "images/04_container_2019-12-12-23-01-09.png "> </p>
<p>The member function like the string.</p>
<p><strong>Operations</strong></p>
<ul>
<li>[], access the array member.</li>
<li>capacity, get the memory size.</li>
<li>reserve to change the memory size.</li>
<li>resize, change the size.</li>
<li>pop_back, push_back</li>
<li>insert (to any place)</li>
<li>erase (any place)</li>
<li>emplace (and place)</li>
<li>empalce_back</li>
</ul>
<h3 id="capacity-change"><a class="header-anchor" href="#capacity-change"></a>capacity change</h3>
<p>If a container has push and pop, it means the container has good performance doing it. As a vector, push_back, and pop_back are O(1) amortized.<br>
However, when push_back, insert, reserve, resize will cause memory reallocation, the vector will ‘MOVE’ the old element to the new memory address. Vector needs to protect the exception, so it will use a constructor will not through the exception(a function using noexcept). So it will use a copy constructor. Therefore, for custom element types that cost more to use copy constructor, we should define a move constructor, and defined as <strong>noexcept</strong>, or we can only put the pointer. This is the reason we need to use the noexcept in the smart_ptr.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>; </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Obj1</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>: </span><br><span class="line"> Obj1()</span><br><span class="line"> &#123;</span><br><span class="line"> <span class="built_in">cout</span> &lt;&lt; <span class="string">"Obj1() \n"</span>; </span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> Obj1(<span class="keyword">const</span> Obj1&amp;)</span><br><span class="line"> &#123;</span><br><span class="line"> <span class="built_in">cout</span> &lt;&lt; <span class="string">"Obj1(const Obj1&amp;) \n"</span>; </span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> Obj1(Obj1&amp;&amp;)</span><br><span class="line"> &#123;</span><br><span class="line"> <span class="built_in">cout</span> &lt;&lt; <span class="string">"Obj1(Obj1&amp;&amp;) \n"</span>; </span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Obj2</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>: </span><br><span class="line"> Obj2()</span><br><span class="line"> &#123;</span><br><span class="line"> <span class="built_in">cout</span> &lt;&lt; <span class="string">"Obj2() \n"</span>; </span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> Obj2(<span class="keyword">const</span> Obj2&amp;)</span><br><span class="line"> &#123;</span><br><span class="line"> <span class="built_in">cout</span> &lt;&lt; <span class="string">"Obj2(const Obj2&amp;) \n"</span>; </span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> Obj2(Obj2&amp;&amp;) <span class="keyword">noexcept</span></span><br><span class="line"> &#123;</span><br><span class="line"> <span class="built_in">cout</span> &lt;&lt; <span class="string">"Obj2(Obj2&amp;&amp;) \n"</span>; </span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Difference between the obj1 and obj2 is the move constructor has a noexcept, which means the move constructor will not cause an exception. </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="built_in">vector</span>&lt;Obj1&gt; v1; </span><br><span class="line"> v1.reserve(<span class="number">2</span>); </span><br><span class="line"> v1.empalce_back(); </span><br><span class="line"> v1.empalce_back(); </span><br><span class="line"> v1.empalce_back(); </span><br><span class="line"></span><br><span class="line"> <span class="built_in">vector</span>&lt;Obj2&gt; v2; </span><br><span class="line"> v2.reserve(<span class="number">2</span>); </span><br><span class="line"> v2.emplace_back(); </span><br><span class="line"> v2.emplace_back(); </span><br><span class="line"> v2.emplace_back(); </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Out put of the previous program.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Obj1() </span><br><span class="line">Obj1() </span><br><span class="line">Obj1() </span><br><span class="line">Obj1(const Obj1&amp;) </span><br><span class="line">Obj1(const Obj1&amp;) </span><br><span class="line">Obj2() </span><br><span class="line">Obj2() </span><br><span class="line">Obj2() </span><br><span class="line">Obj2(Obj2&amp;&amp;)</span><br></pre></td></tr></table></figure>
<h3 id="Difference-empalce-back-and-push-back"><a class="header-anchor" href="#Difference-empalce-back-and-push-back"></a>Difference empalce_back and push_back</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="built_in">vector</span>&lt;Obj1&gt; v1;</span><br><span class="line"> v1.reserve(<span class="number">10</span>); </span><br><span class="line"> <span class="built_in">cout</span> &lt;&lt; <span class="string">"Push Back"</span> &lt;&lt; <span class="built_in">endl</span>; </span><br><span class="line"> v1.push_back(Obj1()); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Push Back</span><br><span class="line">Obj1() </span><br><span class="line">Obj1(Obj1&amp;&amp;) </span><br><span class="line">Obj1(~Obj1()) </span><br><span class="line">Obj1(~Obj1())</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="built_in">vector</span>&lt;Obj1&gt; v1;</span><br><span class="line"> v1.reserve(<span class="number">10</span>); </span><br><span class="line"> <span class="built_in">cout</span> &lt;&lt; <span class="string">"emplace back"</span> &lt;&lt; <span class="built_in">endl</span>; </span><br><span class="line"> v1.emplace_back();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">emplace back</span><br><span class="line">Obj1() </span><br><span class="line">Obj1(~Obj1()</span><br></pre></td></tr></table></figure>
<p>use reserve to reserve the size of a vector can increase the performance.</p>
<h2 id="Deque"><a class="header-anchor" href="#Deque"></a>Deque</h2>
<p>deque: double-ended queue. Can push_front and push_back.</p>
<ul>
<li>push_front, empalce_front, and pop_front.</li>
<li><strong>do not have</strong> data, capacity, and reserve.</li>
</ul>
<p align = "center"> <img width = "500" src = "images/04_container_2019-12-13-00-11-51.png "> </p>
<ul>
<li>only part of the data are saved continuous.</li>
<li>index[i / chunk_size][i % chunk_size]</li>
</ul>
<h2 id="List"><a class="header-anchor" href="#List"></a>List</h2>
<p>the list is a <strong>doubly-linked list</strong>.</p>
<ul>
<li>insert any place O(1).</li>
<li>can not randomly access.</li>
<li>push_front, empalce_front, pop_front.</li>
<li>no data, capacity, and reserve.</li>
</ul>
<p>Every element in the array are not continuous allocated.</p>
<ul>
<li>merge</li>
<li>remove</li>
<li>remove_if</li>
<li>reverse</li>
<li>sort (this is different with std::sort())</li>
<li>unique</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sort(vec.begin(), vec.end()); <span class="comment">// OK</span></span><br><span class="line"><span class="comment">// sort(lst.begin(), lst.end()); // Error</span></span><br><span class="line">lst.sort(); <span class="comment">// OK</span></span><br></pre></td></tr></table></figure>
<p>Sorting a list is different from sorting a verctor which is a random access data structure.</p>
<h2 id="Forward-List"><a class="header-anchor" href="#Forward-List"></a>Forward List</h2>
<p>The forward list is a single linked list.</p>
<p align = "center"> <img width = "500" src = "images/04_container_2019-12-13-00-22-42.png "> </p>
<p>To save memory space. However, it can support insert_after, can not support inset to a particular space. It does not have a backward pointer, so it can not connect to the previous node.</p>
<h2 id="Queue"><a class="header-anchor" href="#Queue"></a>Queue</h2>
<p>Abstract data structure. (container adaptor)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Container</span> = <span class="title">deque</span>&lt;T&gt; &gt; <span class="title">class</span> <span class="title">queue</span>;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>empty</li>
<li>size</li>
<li>front</li>
<li>back</li>
<li>push_back</li>
<li>pop_front</li>
</ul>
<p align = "center"> <img width = "500" src = "images/04_container_2019-12-13-00-28-55.png "> </p>
<ul>
<li>empalce -&gt; emplace_back</li>
<li>push -&gt; push_back</li>
<li>pop -&gt; pop_front</li>
</ul>
<p>can not scan the queue, there is no begin() and end()</p>
<h2 id="Stack"><a class="header-anchor" href="#Stack"></a>Stack</h2>
<p>abstrct data type</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Container</span> = <span class="title">deque</span>&lt;T&gt; &gt; <span class="title">class</span> <span class="title">stack</span>;</span></span><br></pre></td></tr></table></figure>
<p align = "center"> <img width = "500" src = "images/04_container_2019-12-13-00-31-35.png "> </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/12/DeepLearning-Nature/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liang Xu">
      <meta itemprop="description" content="This is the place for Liang to make any notes if he feels like it">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liang Xu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/12/DeepLearning-Nature/" class="post-title-link" itemprop="url">DeepLearning_Nature</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-12 14:03:58" itemprop="dateCreated datePublished" datetime="2019-12-12T14:03:58-05:00">2019-12-12</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Deep-Learning"><a class="header-anchor" href="#Deep-Learning"></a>Deep Learning</h1>
<p>This paper is published in 2015 in Nature, and it is a very important work for deep learning. After this work, deep learning still has a huge improvement. For this paper, I will list all the sentences I feel like to share with.</p>
<h2 id="1-Introduction"><a class="header-anchor" href="#1-Introduction"></a>1. Introduction</h2>
<blockquote>
<p><strong>Deep learning</strong> allows <strong>computational models</strong> that are composed of <strong>multiple processing layers</strong> to learn <strong>representations</strong> of data with <strong>multiple levels</strong> of <strong>abstraction</strong>.</p>
</blockquote>
<p>First of all, the deep learning model is a computational model and is composed of multiple processing layers, which means whatever method they used they used it multiple times. And the model is a representation learning, so it will find a way to represent the data by multiple levels of abstraction.</p>
<blockquote>
<p>Deep learning discovers <strong>intricate structure</strong> in large data sets by using the <strong>backpropagation algorithm</strong> to indicate how a machine should change its internal parameters that are used to <strong>compute the representation in each layer</strong> from the <strong>representation in the previous layer</strong>.</p>
</blockquote>
<p>Backpropagation is the model that allows the model to change the internal parameters for each layer from the previous layer.</p>
<p>Compare with the conventional machine learning techniques, deep learning can learn the data in their raw form by extracting features from the input and output relation. For deceases, constructing a machine learning algorithm requires careful engineering and considerable domain expertise to design a feature extractor than transformed the raw data into a suitable internal representation or feature vector.</p>
<blockquote>
<p>Representation learning is a set of methods that allows a machine to be fed with raw data and to <strong>automatically discover</strong> the <strong>representations</strong> needed for detection or classification. Deep learning methods are representation learning methods with multiple levels of representation, obtained by composing <strong>simple but non-linear modules</strong> that each transform the representation at one level (starting with the raw input) into a representation at a higher, slightly more abstract level.</p>
</blockquote>
<p>The key aspect of deep learning is that these layers of features are not designed by a human, instead, they are learned from data using a general-purpose learning procedure.</p>
<h2 id="Supervised-Learning"><a class="header-anchor" href="#Supervised-Learning"></a>Supervised Learning</h2>
<p>For typical supervised learning, the machine model used to have a fixed size input and fixed output. The input is raw data or hand made features vectors, and the model expected to find the relationship between the input and the output. For deep learning case, the machine modified its internal adjustable parameters to reduce the error score. These adjustable parameters, often called weights, are real numbers that can be seen as ‘knobs’ that define the input-output function of the machine.</p>
<blockquote>
<p>To properly <strong>adjust the weight vector</strong>, the learning algorithm computes a <strong>gradient vector</strong> that, for <em>each weight, indicates by what amount the error would increase or decrease if the weight was increased by a tiny amount</em>. The weight vector is then adjusted in the opposite direction to the gradient vector.</p>
</blockquote>
<p>This is how to adjust the weight vector by using the gradient method, but how many trainings are used to update the weight?</p>
<blockquote>
<p>The objective function averaged over all the training examples, can be seen as a kind of hilly landscape in the high-dimensional space of weight values. The negative gradient vector indicates the direction of steepest descent in this landscape, taking it closer to a minimum, where the output error is low on average.</p>
</blockquote>
<p>So it says using all the training data to find the steepest descent. However, this is not reality. Deep learning usually using a large amount of data, and using all the data to update is very inefficient and also memory size is limited.</p>
<blockquote>
<p>In practice, most practitioners use a procedure called stochastic gradient descent (SGD). This consists of showing the input vector for a few examples, computing the outputs and the errors, computing the average gradient for those examples, and adjusting the weights accordingly. The process is repeated for many small sets of examples from the training set until the average of the objective function stops decreasing. It is called stochastic because each small set of examples gives a noisy estimate of the average gradient overall examples.</p>
</blockquote>
<blockquote>
<p><strong>selectivity–invariance dilemma</strong><br>
One that produces representations that are selective to the aspects of the images that are important for discrimination, but that are invariant to irrelevant aspects such as the pose of the animal.</p>
</blockquote>
<blockquote>
<p>A deep-learning architecture is a <strong>multilayer stack of simple modules</strong>, all (or most) of which are subject to learning, and many of which compute non-linear input-output mappings. <strong>Each module in the stack transforms its input to</strong> <strong>increase both the selectivity and the invariance of the representation</strong>. With multiple non-linear layers, say a depth of 5 to 20, a system can implement extremely intricate functions of its inputs that are simultaneously <strong>sensitive to minute details</strong> and <strong>insensitive to large irrelevant variations</strong> such as the background, pose, lighting and surrounding objects.</p>
</blockquote>
<h3 id="Backpropagation-to-train-multilayer-architectures"><a class="header-anchor" href="#Backpropagation-to-train-multilayer-architectures"></a>Backpropagation to train multilayer architectures</h3>
<blockquote>
<p>The backpropagation procedure to compute the gradient of an objective function with respect to the weights of a multilayer stack of modules is nothing more than a practical application of the chain rule for derivatives.</p>
</blockquote>
<p align = "center"> <img width = "500" src = "images/00_DeepLearning_2019-12-12-01-02-20.png "> </p>
<p>Figure 1, Multilayer neural networks and backpropagation. <strong>a</strong>, A multi- layer neural network (shown by the connected dots) can distort the input space to make the classes of data (examples of which are on the red and blue lines) linearly separable.</p>
<p align = "center"> <img width = "500" src = "images/00_DeepLearning_2019-12-12-01-02-50.png "> </p>
<p><strong>b</strong>, b, The chain rule of derivatives tells us how two small effects (that of a small change of x on y, and that of y on z) are composed. A small change $\nabla x$ in $x$ gets transformed first into a small change $\Delta y$ in $y$ by getting multiplied by $\partial{y}/\partial{x}$. Similarly, the change of $\nabla y$ creates a change of $\nabla z$ in $z$. Substituting one equation into the other gives the chain rule of derivatives - how $\nabla x$ gets turned into $\nabla z$ through multiplication by the product of $\partial{y}/\partial{x}$ and $\partial{z}/\partial{x}$. It also works when $x$, $y$ and $z$ are vectors.</p>
<p align = "center"> <img width = "500" src = "images/00_DeepLearning_2019-12-12-01-02-59.png "> </p>
<p>This is one of the examples for forwarding computing. The equations used for computing the forward pass in a neural net with two hidden layers and one output layer, each constituting a module through which one can backpropagate gradients. At each layer, we first compute to total input $z$ to each unit, which is a weighted sum of the outputs of the units in the layer below. The nonlinear function $f(.)$ is applied to $z$ to get the output of the unit(For simplicity, we have omitted bias terms.<br>
). The non-linear functions used in neural networks include the rectified linear unit (ReLU) $f(z) = max(0, z)$, commonly used in recent years, as well as the more conventional sigmoids, such as the hyperbolic tangent, $f(z) = (\exp(z) - \exp(-z)) / (\exp(z) + \exp(-z))$ and the logistic function logistic, $f(z) = 1/(1 + \exp(-z))$.</p>
<p>Equation for the output.</p>
<p>$$<br>
\begin{aligned}<br>
y_l &amp;= f(z_l) \<br>
z_l &amp;= \sum_{k \in H_2}{w_{kl}y_{k}}<br>
\end{aligned}<br>
$$</p>
<p>Equation for the Hidden units H2.</p>
<p>$$<br>
\begin{aligned}<br>
y_k &amp;= f(z_k) \<br>
z_k &amp;= \sum_{j \in H_1}{w_{jk}y_{j}}<br>
\end{aligned}<br>
$$</p>
<p>Equation for the Hidden units H1.</p>
<p>$$<br>
\begin{aligned}<br>
y_j &amp;= f(z_j) \<br>
z_j &amp;= \sum_{i \in input}{w_{ij}x_{i}}<br>
\end{aligned}<br>
$$</p>
<p align = "center"> <img width = "500" src = "images/00_DeepLearning_2019-12-12-01-03-10.png "> </p>
<p><strong>d</strong>, The equations used for computing the backward pass. At each hidden layer, we compute the error derivative with respect to the output of each unit, which is a weighted sum of the error derivatives with respect to the total inputs to the units in the layers above. We then convert the error derivative with respect to the output into the error derivative with respect to the input by multiplying it by the gradient of $f(z)$. At the output layer, the error derivative with respect to the output of a unit is computed by differentiating the cost function. This gives $y_{l} - t_{l}$ if the cost function for unit l is $0.5(y_l - t_l)^2$, where $t_l$ is the target value. Once the $\partial{E}/\partial{z_k}$ is known, the error-derivative for the weight $w_{jk}$ on the connection form unit $j$ in the layer below is just $y_j \partial{E}/\partial{k}$. In this example:<br>
Derivative for the output layer. The error function assumed as $0.5(y_l - t_l)^2$.</p>
<p>$$<br>
\begin{aligned}<br>
\frac{\partial{E}}{\partial{y_l}} &amp;= y_l - t_l \<br>
\frac{\partial{E}}{\partial{z_l}} &amp;= \frac{\partial{E}}{\partial{y_l}} \frac{\partial{y_l}}{\partial{z_l}}<br>
\end{aligned}<br>
$$</p>
<p>The derivative for the Hidden 1. And every node affected by every node in the above layer.</p>
<p>$$<br>
\begin{aligned}<br>
\frac{\partial{E}}{\partial{y_k}} &amp;= \sum_{I \in out}{w_{kl}\frac{\partial{E}}{\partial{z_l}}} \<br>
\frac{\partial{E}}{\partial{z_k}} &amp;= \frac{\partial{E}}{\partial{y_k}} \frac{\partial{y_k}}{\partial{z_k}}<br>
\end{aligned}<br>
$$</p>
<p>The backpropagation can give you all the gradient you need to know in order to change the weights.</p>
<p>$$<br>
\begin{aligned}<br>
\frac{\partial{E}}{\partial{y_j}} &amp;= \sum_{k \in H2}{w_{jk}\frac{\partial{E}}{\partial{z_k}}} \<br>
\frac{\partial{E}}{\partial{z_j}} &amp;= \frac{\partial{E}}{\partial{y_j}} \frac{\partial{y_j}}{\partial{z_j}}<br>
\end{aligned}<br>
$$</p>
<blockquote>
<p>The backpropagation equation can be applied repeatedly to propagate gradients through all modules, starting from the output at the top (where the network produces its prediction) all the way to the bottom (where the external input is fed). Once these gradients have been computed, it is straightforward to compute the gradients with respect to the weights of each module.</p>
</blockquote>
<h3 id="Local-Minima"><a class="header-anchor" href="#Local-Minima"></a>Local Minima</h3>
<p>In particular, backpropagation was commonly thought that simple gradient descent would get trapped in <strong>poor local minima</strong> — weight configurations for which no small change would reduce the average error.</p>
<p>In practice, poor local minima are rarely a problem with large networks. Regardless of the initial conditions, the system nearly always reaches solutions of very similar quality. Recent theoretical and empirical results strongly suggest that local minima are not a serious issue in general.</p>
<p>Instead, the landscape is packed with a combinatorially large number of <strong>saddle points</strong> where the <strong>gradient</strong> is zero, and the <strong>surface curves up</strong> in most dimensions and <strong>curves down</strong> in the remainder. The analysis seems to show that saddle points with only a few downward curving directions are present in very large numbers, but almost all of them have very similar values of the objective function. Hence, it does not much matter which of these saddle points the algorithm gets stuck at.</p>
<h2 id="Convolutional-neural-networks"><a class="header-anchor" href="#Convolutional-neural-networks"></a>Convolutional neural networks</h2>
<p>ConvNets are designed to process data that come in the form of multiple arrays.<br>
There are four key ideas behind ConvNets that take advantage of the properties of natural signals:</p>
<ul>
<li>local connections</li>
<li>shared weights,</li>
<li>pooling and the</li>
<li>use of many layers.</li>
</ul>
<p align = "center"> <img width = "500" src = "images/00_DeepLearning_2019-12-12-01-11-14.png "> </p>
<p>Figure2: Each rectangular image is a feature map corresponding to the output for one of the learned features, detected at each of the image positions. Information flows bottom-up, with lower-level features acting as oriented edge detectors, and a score is computed for each image class in output. ReLU, rectified linear unit.</p>
<p>The first few stages are composed of two types of layers: <strong>convolutional layers</strong> and <strong>pooling layers</strong>. Units in a convolutional layer are organized in <strong>feature maps</strong>, within which <strong>each unit is connected to local patches</strong> in the feature maps of the previous layer through a set of weights called a <strong>filter bank</strong>. The result of this local weighted sum is then passed through a nonlinearity such as a ReLU. All units in a feature map share the same filter bank. Different feature maps in a layer use different filter banks. Two reasons:</p>
<ul>
<li>First, in array data such as images, local groups of values are often highly correlated, forming distinctive local motifs that are easily detected.</li>
<li>Second, the local statistics of images and other signals are invariant to location. In other words, if a motif can appear in one part of the image, it could appear anywhere, hence the idea of units at different locations sharing the same weights and detecting the same pattern in different parts of the array.</li>
</ul>
<p>The role of the <strong>pooling layer</strong> is to <strong>merge</strong> <strong>semantically similar</strong> features into one. Because the relative positions of the features forming a motif can vary somewhat, reliably detecting the motif can be done by coarse-graining the position of each feature.</p>
<p>Backpropagating gradients through a ConvNet is as simple as through a regular deep network, allowing all the weights in all the filter banks to be trained.</p>
<h2 id="Image-understanding-with-deep-convolutional-networks"><a class="header-anchor" href="#Image-understanding-with-deep-convolutional-networks"></a>Image understanding with deep convolutional networks</h2>
<p>A recent stunning demonstration combines ConvNets and recurrent net modules for the generation of image captions.</p>
<p align = "center"> <img width = "500" src = "images/00_DeepLearning_2019-12-12-01-11-26.png "> </p>
<p>Figure 3 | From image to text. Captions generated by a recurrent neural network(RNN) tanking as an extra input, the representation extracted by a deep convolution network (CNN) from a test image, with the RNN trained to ‘translate’ high-level representations of images into captions. When the RNN is given the ability to focus its attention on a different location in the input image as it generates each word</p>
<h2 id="Distributed-representations-and-language-processing"><a class="header-anchor" href="#Distributed-representations-and-language-processing"></a>Distributed representations and language processing</h2>
<p>Deep-learning theory shows that deep nets have two different exponential advantages over classical learning algorithms that do not use <strong>distributed representations</strong>. Both of these advantages arise from the power of composition and depend on the underlying data-generating distribution having an appropriate componential structure. Both of these advantages arise from the power of composition and depend on the underlying data-generating distribution having an appropriate componential structure.</p>
<ul>
<li>First, learning distributed representations enable generalization to new combinations of the values of learned features beyond those seen during training.</li>
<li>Second, composing layers of representation in a deep net bring the potential for another exponential advantage.</li>
</ul>
<p align = "center"> <img width = "500" src = "images/00_DeepLearning_2019-12-12-13-49-10.png "> </p>
<p align = "center"> <img width = "500" src = "images/00_DeepLearning_2019-12-12-13-46-30.png "> </p>
<p align = "center"> <img width = "500" src = "images/00_DeepLearning_2019-12-12-13-46-45.png "> </p>
<p>Figure 4 | Visualizing the learned word vectors.</p>
<h2 id="Recurrent-neural-networks"><a class="header-anchor" href="#Recurrent-neural-networks"></a>Recurrent neural networks</h2>
<p>RNNs process an input sequence one element at a time, maintaining in their hidden units a ‘state vector’ that implicitly contains information about the history of all the past elements of the sequence. When we consider the outputs of the hidden units at different discrete time steps as if they were the outputs of different neurons in a deep multilayer network (Fig. 5, right), it becomes clear how we can apply backpropagation to train RNNs.</p>
<p align = "center"> <img width = "500" src = "images/00_DeepLearning_2019-12-12-01-11-41.png "> </p>
<p>Figure 5. A recurrent neural network and the unfolding in time of the computation involved in its forward computation.</p>
<p>RNNs are very powerful dynamic systems, but training them has proved to be problematic because the backpropagated gradients either <strong>grow or shrink</strong> at each time step, so over many time steps they typically <strong>explode or vanish</strong>.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/10/Basic-Data-Structure-week1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liang Xu">
      <meta itemprop="description" content="This is the place for Liang to make any notes if he feels like it">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liang Xu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/10/Basic-Data-Structure-week1/" class="post-title-link" itemprop="url">Basic_Data_Structure_week1</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-10 12:47:13" itemprop="dateCreated datePublished" datetime="2019-12-10T12:47:13-05:00">2019-12-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="BASIC-DATA-STRUCTURES"><a class="header-anchor" href="#BASIC-DATA-STRUCTURES"></a>BASIC DATA STRUCTURES</h1>
<h2 id="1-Arrays-and-Linked-Lists"><a class="header-anchor" href="#1-Arrays-and-Linked-Lists"></a>1. Arrays and Linked Lists</h2>
<blockquote>
<p>Definition<br>
<strong>Array</strong><br>
<code>Contiguous area of memory consisting of equal-size elements indexed by contiguous integers.</code></p>
</blockquote>
<h3 id="What-is-special-about-arrays"><a class="header-anchor" href="#What-is-special-about-arrays"></a>What is special about arrays?</h3>
<ul>
<li>Constant time access<br>
Find the element by address <strong>array_addr + elem_size × (i − first_index)</strong></li>
</ul>
<h3 id="Multi-Dimensional-Arrays"><a class="header-anchor" href="#Multi-Dimensional-Arrays"></a>Multi-Dimensional Arrays</h3>
<p>Most of the language support multi dimension array. However, if the language does not support this, you can always create the array by only using one dimension and an equation.</p>
<p align="center">
  <img width="400" src="images_week1/1.png">
</p>
<p>According to the access pattern, the multi-dimension array can be saved as row major based or colum major based.</p>
<p align="center">
  <img width="400" src="images_week1/2.png">
</p>
<h3 id="Times-for-common-operations"><a class="header-anchor" href="#Times-for-common-operations"></a>Times for common operations</h3>
<p>Add and remove are tow common</p>
<p align="center">
  <img width="400" src="images_week1/3.png">
</p>
<ol>
<li>
<p>add/remove to the beginning of the array need to move everything back by one, so ti is O(n) operation. Same like add in the middle of array.</p>
</li>
<li>
<p>add/remove from the end of the array are very easy, just move the pointer forward one step.</p>
</li>
</ol>
<h3 id="Summary"><a class="header-anchor" href="#Summary"></a>Summary</h3>
<ol>
<li><strong>Array:</strong> Contiguous area of memory consisting of equal-size elements indexed by contiguous integers.</li>
<li>Constant-time access to any element.</li>
<li>Constant time to add/remove at the end.</li>
<li>Linear time to add/remove tat an arbitrary location.</li>
</ol>
<h2 id="Linked-Lists"><a class="header-anchor" href="#Linked-Lists"></a>Linked Lists</h2>
<p align="center">
  <img width="400" src="images_week1/4.png">
</p>
<p>Linked Lists:</p>
<ul>
<li>keys</li>
<li>Pointes</li>
</ul>
<h3 id="List-API"><a class="header-anchor" href="#List-API"></a>List API</h3>
<ul>
<li><strong>PushFront(Key)</strong> : add to front</li>
<li><strong>Key TopFront()</strong> : return front item</li>
<li><strong>PopFront()</strong> : remove front item</li>
<li><strong>PushBack(Key)</strong> : add to back</li>
<li><strong>Key TopBack()</strong> : return back item</li>
<li><strong>PopBack()</strong> : remove back item</li>
<li><strong>Boolean Find(Key)</strong> : is key in list?</li>
<li><strong>Erase(Key)</strong> : remove key from list</li>
<li><strong>Boolean Empty()</strong> : empty list?</li>
<li><strong>AddBefore(Node, Key)</strong> : adds key before node</li>
<li><strong>AddAfter(Node, Key)</strong> : adds key after node</li>
</ul>
<h3 id="Times-for-some-Operations"><a class="header-anchor" href="#Times-for-some-Operations"></a>Times for some Operations</h3>
<h4 id="Push-front"><a class="header-anchor" href="#Push-front"></a>Push_front</h4>
<p>Push front can be treated as reconnect the dummy head node.<br>
Just remember do not lost your head any time.</p>
<p align="center">
  <img width="400" src="images_week1/5.png">
</p>
<p>Step1: Let the new node pointed to the current head.</p>
<p align="center">
  <img width="400" src="images_week1/6.png">
</p>
<p>Step2: Dummy head pointed to the new head.</p>
<p align="center">
  <img width="400" src="images_week1/7.png">
</p>
<p align="center">
  <img width="400" src="images_week1/10.png">
</p>
<p align="center">
  <img width="400" src="images_week1/11.png">
</p>
<p>For pop front, we need to think about the case when front is Empty.<br>
So we need to check it first.<br>
Time: O(1)</p>
<h4 id="PushBack-no-tile-pointer"><a class="header-anchor" href="#PushBack-no-tile-pointer"></a>PushBack (no tile pointer)</h4>
<p align="center">
  <img width="400" src="images_week1/8.png">
</p>
<p>This is o(n) operation, because we need to find the key first.</p>
<h4 id="PushBack-with-tile-pointer"><a class="header-anchor" href="#PushBack-with-tile-pointer"></a>PushBack (with tile pointer)</h4>
<p align="center">
  <img width="400" src="images_week1/9.png">
</p>
<p align="center">
  <img width="400" src="images_week1/12.png">
</p>
<p>Check the tail.next is nullptr or not.</p>
<h3 id="Summary-v2"><a class="header-anchor" href="#Summary-v2"></a>Summary</h3>
<p align="center">
  <img width="400" src="images_week1/13.png">
</p>
<h2 id="Doubly-Linked-List"><a class="header-anchor" href="#Doubly-Linked-List"></a>Doubly Linked List</h2>
<p align="center">
  <img width="400" src="images_week1/14.png">
</p>
<p>Node Contains:</p>
<ol>
<li>key</li>
<li>next pointer</li>
<li>prev pointer</li>
</ol>
<h3 id="some-detailed"><a class="header-anchor" href="#some-detailed"></a>some detailed</h3>
<p align="center">
  <img width="400" src="images_week1/15.png">
</p>
<p align="center">
  <img width="400" src="images_week1/16.png">
</p>
<h3 id="Summary-v3"><a class="header-anchor" href="#Summary-v3"></a>Summary</h3>
<ul>
<li>
<p>Constant time to insert ar or remove from the front.</p>
</li>
<li>
<p>With tail and doubly-linked, constant time to insert at or remove from the back</p>
</li>
<li>
<p>o(n) time to find arbitrary element. (both index and content)</p>
</li>
<li>
<p>List elements need not be contiguous. (not good for sequence access, but good for dynamic memory operations).</p>
</li>
<li>
<p>With doubly-linked list, constant time to insert between nodes or remove a node.</p>
</li>
</ul>
<h2 id="Stack-and-Queues"><a class="header-anchor" href="#Stack-and-Queues"></a>Stack and Queues</h2>
<h3 id="Stack"><a class="header-anchor" href="#Stack"></a>Stack</h3>
<blockquote>
<p>Definitions:<br>
<strong>Stack</strong>: Abstract data type with the following opeartions</p>
<ul>
<li>Push(Key): adds key to collection</li>
<li>Key Top(): returns most recently-added key</li>
<li>Key Pop(): removes and returns most recently-added key</li>
<li>Boolean Empty(): are there any elements?</li>
</ul>
</blockquote>
<p align="center">
  <img width="400" src="images_week1/17.png">
</p>
<p align="center">
  <img width="400" src="images_week1/18.png">
</p>
<h4 id="Implementation"><a class="header-anchor" href="#Implementation"></a>Implementation</h4>
<p>Stack can be implemented as array or linked list.</p>
<h4 id="Summary-v4"><a class="header-anchor" href="#Summary-v4"></a>Summary</h4>
<ul>
<li>Stacks can be implemented with either an array or a linked list.</li>
<li>Each stack operation is O(1): Push, Pop, Top, Empty.</li>
<li>Stacks are ocassionaly known as LIFO queues.</li>
</ul>
<h3 id="Queue"><a class="header-anchor" href="#Queue"></a>Queue</h3>
<blockquote>
<p>Definitions:<br>
<strong>Queue</strong>: Abstract data type with the following operations</p>
<ul>
<li>Enqueue(Key): adds key to collection</li>
<li>Key Dequeue(): removes and returns least recently-added key</li>
<li>Boolean Empty(): are there any elements?</li>
</ul>
</blockquote>
<h4 id="With-linked-List"><a class="header-anchor" href="#With-linked-List"></a>With linked List</h4>
<p align="center">
  <img width="400" src="images_week1/19.png">
</p>
<p align="center">
  <img width="400" src="images_week1/20.png">
</p>
<h4 id="With-Array"><a class="header-anchor" href="#With-Array"></a>With Array</h4>
<p>Using two Pointers</p>
<p align="center">
  <img width="400" src="images_week1/22.png">
</p>
<p align="center">
  <img width="400" src="images_week1/21.png">
</p>
<p align="center">
  <img width="400" src="images_week1/23.png">
</p>
<h4 id="Summary-v5"><a class="header-anchor" href="#Summary-v5"></a>Summary</h4>
<ul>
<li>Queues can be implemented with either a linked list (with tail pointer) or an array.</li>
<li>Each queue operation is O(1): Enqueue, Dequeue, Empty.</li>
</ul>
<h2 id="Trees"><a class="header-anchor" href="#Trees"></a>Trees</h2>
<blockquote>
<p>Definition<br>
A Tree is:</p>
<ul>
<li>empty, or</li>
<li>a node with:
<ul>
<li>a key, and</li>
<li>a list of child trees.</li>
</ul>
</li>
</ul>
</blockquote>
<p>Node contains:</p>
<ul>
<li>key</li>
<li>children: list of children nodes</li>
<li>(optional) parent</li>
</ul>
<p align="center">
  <img width="400" src="images_week1/24.png">
</p>
<p align="center">
  <img width="400" src="images_week1/25.png">
</p>
<h3 id="Walking-a-Tree"><a class="header-anchor" href="#Walking-a-Tree"></a>Walking a Tree</h3>
<p>Often we want to visit the nodes of a tree in a particular order.</p>
<ul>
<li>Depth-first: We completely traverse one sub-tree before exploring a sibling sub-tree.</li>
<li>Breadth-first: We traverse all nodes at one level before progressing to the next level.</li>
</ul>
<h4 id="DFS"><a class="header-anchor" href="#DFS"></a>DFS</h4>
<h5 id="Inorder-Traversal"><a class="header-anchor" href="#Inorder-Traversal"></a>Inorder Traversal</h5>
<p align="center">
  <img width="400" src="images_week1/26.png">
</p>
<p align="center">
  <img width="400" src="images_week1/27.png">
</p>
<h5 id="PreOrder-Traversal"><a class="header-anchor" href="#PreOrder-Traversal"></a>PreOrder Traversal</h5>
<p align="center">
  <img width="400" src="images_week1/28.png">
</p>
<p align="center">
  <img width="400" src="images_week1/29.png">
</p>
<h5 id="PostOrder-Traversal"><a class="header-anchor" href="#PostOrder-Traversal"></a>PostOrder Traversal</h5>
<p align="center">
  <img width="400" src="images_week1/30.png">
</p>
<p align="center">
  <img width="400" src="images_week1/31.png">
</p>
<h4 id="BFS"><a class="header-anchor" href="#BFS"></a>BFS</h4>
<p>Level order Traversal<br>
Need to queue to keep track the element going to explore.</p>
<p align="center">
  <img width="400" src="images_week1/32.png">
</p>
<h3 id="Summary-v6"><a class="header-anchor" href="#Summary-v6"></a>Summary</h3>
<ul>
<li>Trees are used for lots of different things.</li>
<li>Trees have a key and children.</li>
<li>Tree walks: DFS (pre-order, in-order, post-order) and BFS.</li>
<li>When working with a tree, recursive algorithms are common.</li>
<li>In Computer Science, <strong>trees grow down</strong>!</li>
</ul>
<p>All the material in this post are come from EDX:Algorithms and Data Structures MicroMasters and Data Structures Fundamentals (Week1)[<a href="https://courses.edx.org/courses/course-v1:UCSanDiegoX+ALGS201x+1T2019/course/" target="_blank" rel="noopener">https://courses.edx.org/courses/course-v1:UCSanDiegoX+ALGS201x+1T2019/course/</a>]</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/09/leetcode-context166/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liang Xu">
      <meta itemprop="description" content="This is the place for Liang to make any notes if he feels like it">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liang Xu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/09/leetcode-context166/" class="post-title-link" itemprop="url">leetcode_context166</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-09 23:50:48" itemprop="dateCreated datePublished" datetime="2019-12-09T23:50:48-05:00">2019-12-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Question-1-Leetcode-1281-Subtract-the-Product-and-Sum-of-Digits-of-an-Integer"><a class="header-anchor" href="#Question-1-Leetcode-1281-Subtract-the-Product-and-Sum-of-Digits-of-an-Integer"></a>Question 1 : Leetcode 1281 Subtract the Product and Sum of Digits of an Integer</h2>
<blockquote>
<p>Easy<br>
Constraints:</p>
</blockquote>
<ul>
<li>1 &lt;= n &lt;= 10^5</li>
</ul>
<p align="center"> 
<img src="images_leetcode/1281_1.png">
</p>
<p align="center"> 
<img src="images_leetcode/1281_2.png">
</p>
This is a easy question, just need to extract the digits from an integer number. The constrains are 1 <= n <= 10^5, so we do not need to consider the negative value case. Remember the code to decode the digit. 
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">subtractProductAndSum</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>, mul = <span class="number">1</span>;  </span><br><span class="line">        <span class="keyword">while</span>(n != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> digit = n % <span class="number">10</span>; </span><br><span class="line">            sum += digit; </span><br><span class="line">            mul *= digit;</span><br><span class="line">            n = n / <span class="number">10</span>; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mul - sum; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Time-and-space"><a class="header-anchor" href="#Time-and-space"></a>Time and space</h3>
<blockquote>
<ul>
<li>time is : log(n), or constant if n is only int type</li>
<li>space   : constant</li>
</ul>
</blockquote>
<h3 id="Special-case"><a class="header-anchor" href="#Special-case"></a>Special case</h3>
<p>n = 1 is one of the special case</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. sum = 0, mul = 1; </span><br><span class="line">2. digit = 1 % 10 = 1; </span><br><span class="line">3. sum = sum + 1 = 0 + 1 = 1; </span><br><span class="line">4. mul = mul * 1 = 1 * 1 = 1; </span><br><span class="line">5. n = 1 / 10 = 0 // (<span class="built_in">break</span> <span class="keyword">in</span> the next loop)</span><br><span class="line">6. <span class="built_in">return</span> 0;</span><br></pre></td></tr></table></figure>
<h3 id="Template"><a class="header-anchor" href="#Template"></a>Template</h3>
<p>Need to remember the code can get the digits</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; getDigits(<span class="keyword">int</span> n)</span><br><span class="line">&#123; </span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; digits; <span class="comment">// can not know the size in the begining</span></span><br><span class="line">    <span class="keyword">while</span>(n != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> digit = n % <span class="number">10</span>; </span><br><span class="line">        digits.push_back(digit); </span><br><span class="line">        n = n / <span class="number">10</span>; <span class="comment">// remove the last digits</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> digits; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Question2-leetcode-1282-Group-the-People-Given-the-Group-Size-They-Belong-To"><a class="header-anchor" href="#Question2-leetcode-1282-Group-the-People-Given-the-Group-Size-They-Belong-To"></a>Question2: leetcode 1282. Group the People Given the Group Size They Belong To</h2>
<p>There are <strong>n</strong> people whose IDs go <strong>from 0 to n - 1</strong> and each person belongs exactly to one group. Given the array groupSizes of length n telling the group size each person belongs to, return the groups there are and the people’s IDs each group includes.<br>
You can return any solution in any order and the same applies for IDs. Also, it is guaranteed that there exists at least one solution.</p>
<blockquote>
<p>Medium</p>
</blockquote>
<h3 id="Constraints"><a class="header-anchor" href="#Constraints"></a>Constraints</h3>
<p>groupSizes.length == n<br>
1 &lt;= n &lt;= 500<br>
1 &lt;= groupSizes[i] &lt;= n</p>
<p>n is smaller than 500, I think we can create a matrix for that. However, there is a memory issue. I will list this issue, and see any can sovle this problem or not.</p>
<p align="center"> 
<img src="images_leetcode/1282_1.png">
</p>
<p>This is a Hashmap problem, and the key value is the group size. We can scan the array, and push the according number’s index to an vector(we are more interested in the index). When the vector size reach to it key, this means the group is full, then we add this vector to the final result, and clear the vector.<br>
However, we do not have to use a hash map, we can create a vector&lt;vector<int>&gt;, there is an issue with this solution.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; groupThePeople(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; groupSizes) &#123;</span><br><span class="line">        <span class="keyword">int</span> Gsize = groupSizes.size();         </span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; result; </span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; <span class="built_in">map</span>; </span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Gsize; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">map</span>[groupSizes[i]].push_back(i);</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">map</span>[groupSizes[i]].size() == groupSizes[i])</span><br><span class="line">            &#123;</span><br><span class="line">                result.push_back(<span class="built_in">map</span>[groupSizes[i]]); </span><br><span class="line">                <span class="built_in">map</span>[groupSizes[i]].clear(); </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>This result is very slow, and I do not like the hash table in this small problem.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; groupThePeople(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; groupSizes) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> Gsize = groupSizes.size(); </span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; result; </span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; table(Gsize+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Gsize; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            table[groupSizes[i]].push_back(i); </span><br><span class="line">            <span class="keyword">if</span>(table[groupSizes[i]].size() == groupSizes[i])</span><br><span class="line">            &#123;</span><br><span class="line">                result.push_back(table[groupSizes[i]]); </span><br><span class="line">                table[groupSizes[i]] = <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(); </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Now I know the problem. When input is [1] or [2,2]. or [8,8,8,8,8,8,8,8] my code used to have problem. I found the reason is the table size was wrong. I used to have table(Gsize); This is not right, when [1] as input, Gsize is 1, and table in this case is 1, so it only have table[0]. This the main problem, need to be taken care of in the future.</p>
<h3 id="Time-and-space-v2"><a class="header-anchor" href="#Time-and-space-v2"></a>Time and space</h3>
<blockquote>
<ul>
<li>time is : O(n)</li>
<li>space   : O(n^2), used for the table;</li>
</ul>
</blockquote>
<h2 id="Question3-leetcode-1283-Find-the-Smallest-Divisor-Given-a-Threshold"><a class="header-anchor" href="#Question3-leetcode-1283-Find-the-Smallest-Divisor-Given-a-Threshold"></a>Question3: leetcode 1283. Find the Smallest Divisor Given a Threshold</h2>
<p>Given <strong>an array</strong> of <strong>integers nums</strong> and <strong>an integer threshold</strong>, we will choose a <strong>positive integer divisor</strong> and divide all the array by it and sum the result of the division. Find the smallest divisor such that the result mentioned above is less than or equal to threshold.<br>
Each result of division is rounded to the nearest integer greater than or equal to that element. (For example: 7/3 = 3 and 10/2 = 5).<br>
It is guaranteed that there will be an answer.</p>
<blockquote>
<p>Medium</p>
</blockquote>
<h3 id="Constraints-v2"><a class="header-anchor" href="#Constraints-v2"></a>Constraints:</h3>
<ul>
<li>1 &lt;= nums.length &lt;= 5 * 10^4</li>
<li>1 &lt;= nums[i] &lt;= 10^6</li>
<li>nums.length &lt;= threshold &lt;= 10^6</li>
</ul>
<p>Integer can do the job. And array is a big long.</p>
<p align="center"> 
<img src="images_leetcode/1283_1.png">
</p>
<p>This is a binary search question. From the constrain, we know the range of nums[i], so we can search from 1 to 10^6.<br>
This code are borrow from <a href="https://zxi.mytechroad.com/blog/category/algorithms/" target="_blank" rel="noopener">Huahua</a>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">smallestDivisor</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> threshold)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> sums = [&amp;](<span class="keyword">int</span> d)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> sum = <span class="number">0</span>; </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> n : nums)</span><br><span class="line">            &#123;</span><br><span class="line">                sum += (n + d - <span class="number">1</span>) / d;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125;; <span class="comment">// lambda function</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">1</span>; </span><br><span class="line">        <span class="keyword">int</span> right = <span class="number">1e6</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(left &lt;= right)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> mid = left + (right - left) / <span class="number">2</span>; </span><br><span class="line">            <span class="keyword">if</span> (sums(mid) &lt;= threshold)</span><br><span class="line">            &#123;</span><br><span class="line">                right = mid - <span class="number">1</span>; </span><br><span class="line">            &#125; <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                left = mid + <span class="number">1</span>; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> left; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Time-and-space-v3"><a class="header-anchor" href="#Time-and-space-v3"></a>Time and space</h3>
<blockquote>
<ul>
<li>time is : O(nlogk), n is the nums length, and k is 1 to 10^6.</li>
<li>space   : O(1);</li>
</ul>
</blockquote>
<p>There is a small lambda funciton in the code</p>
<h3 id="Lambda-expressions"><a class="header-anchor" href="#Lambda-expressions"></a>Lambda expressions</h3>
<p>Constructs a closure: an unnamed function object capable of capturing variables in scope.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ captures ] ( params ) -&gt; ret &#123; body &#125;</span><br><span class="line">[ captures ] ( params ) &#123; body &#125;</span><br><span class="line">[ captures ] &#123; body &#125;</span><br></pre></td></tr></table></figure>
<p>use <em>auto</em> to capture the return type, otherwise the lambda is a complicated type. The concept of the whole idea will be discussed in the following post.</p>
<h2 id="Question-4-Leetcode-1284-Minimum-Number-of-Flips-to-Convert-Binary-Matrix-to-Zero-Matrix"><a class="header-anchor" href="#Question-4-Leetcode-1284-Minimum-Number-of-Flips-to-Convert-Binary-Matrix-to-Zero-Matrix"></a>Question 4 : Leetcode 1284. Minimum Number of Flips to Convert Binary Matrix to Zero Matrix</h2>
<p>Given a m x n binary matrix mat. In one step, you can choose one cell and flip it and all the four neighbours of it if they exist (Flip is changing 1 to 0 and 0 to 1). A pair of cells are called neighboors if they share one edge.</p>
<p>Return the minimum number of steps required to convert mat to a zero matrix or -1 if you cannot.</p>
<p>Binary matrix is a matrix with all cells equal to 0 or 1 only.</p>
<p>Zero matrix is a matrix with all cells equal to 0.</p>
<p align="center"> 
<img src="images_leetcode/1284_1.png">
</p>
<h3 id="Constraints-v3"><a class="header-anchor" href="#Constraints-v3"></a>Constraints:</h3>
<blockquote>
<ul>
<li>m == mat.length</li>
<li>n == mat[0].length</li>
<li>1 &lt;= m &lt;= 3</li>
<li>1 &lt;= n &lt;= 3</li>
<li>mat[i][j] is 0 or 1.</li>
</ul>
</blockquote>
<p>This is a NP-hard problem, I’d rather to build a memory table for soltuion. because the m and n only [1, 3]. However, we need to use the BFS to every condiction.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">    <span class="keyword">typedef</span> <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; matrix;</span><br><span class="line">    <span class="keyword">int</span> m, n; </span><br><span class="line">    <span class="built_in">map</span>&lt;matrix, <span class="keyword">int</span>&gt; table; </span><br><span class="line">    <span class="comment">// direction</span></span><br><span class="line">    <span class="keyword">int</span> dx[<span class="number">5</span>]&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>&#125;; </span><br><span class="line">    <span class="keyword">int</span> dy[<span class="number">5</span>]&#123;<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;; </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">vector</span>&lt;matrix&gt; get_neighbors(matrix&amp; mat)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;matrix&gt; res; </span><br><span class="line">        <span class="keyword">auto</span> isValid = [&amp;](<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> x &gt;= <span class="number">0</span> &amp;&amp; y &gt;= <span class="number">0</span> &amp;&amp; x &lt; n &amp;&amp; y &lt; m; </span><br><span class="line">        &#125;; </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j)</span><br><span class="line">            &#123;</span><br><span class="line">                matrix tmpM = mat; </span><br><span class="line">                </span><br><span class="line">                <span class="comment">// flip</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> dir = <span class="number">0</span>; dir &lt; <span class="number">5</span>; ++dir)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">int</span> x = i + dx[dir];</span><br><span class="line">                    <span class="keyword">int</span> y = j + dy[dir]; </span><br><span class="line">                    <span class="keyword">if</span>(isValid(x,y))</span><br><span class="line">                    &#123;</span><br><span class="line">                        tmpM[x][y] = !mat[x][y];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                res.push_back(tmpM); </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">bfs</span><span class="params">(matrix&amp; mat)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> check = [&amp;](matrix mat)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">bool</span> good = <span class="number">1</span>; </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;row : mat)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;num : row)</span><br><span class="line">                &#123;</span><br><span class="line">                    good &amp;= !num;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> good; </span><br><span class="line">        &#125;; </span><br><span class="line">        </span><br><span class="line">        <span class="built_in">queue</span>&lt;matrix&gt; q;</span><br><span class="line">        q.push(mat); </span><br><span class="line">        table[mat] = <span class="number">0</span>; </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(q.size())</span><br><span class="line">        &#123;</span><br><span class="line">            matrix mat = q.front(); </span><br><span class="line">            q.pop(); </span><br><span class="line">            </span><br><span class="line">            <span class="keyword">int</span> d = table[mat]; </span><br><span class="line">            <span class="keyword">if</span> (check(mat))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> d; </span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">vector</span>&lt;matrix&gt; nextMat = get_neighbors(mat); </span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; matI : nextMat)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(!table.count(matI))</span><br><span class="line">                &#123;</span><br><span class="line">                    table[matI] = d + <span class="number">1</span>; </span><br><span class="line">                    q.push(matI); </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">minFlips</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; mat)</span> </span>&#123;</span><br><span class="line">        n = mat.size();</span><br><span class="line">        m = mat[<span class="number">0</span>].size(); </span><br><span class="line">        <span class="keyword">return</span> bfs(mat); </span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/09/semi-supervised-Learning-Deep-Generative-Model/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liang Xu">
      <meta itemprop="description" content="This is the place for Liang to make any notes if he feels like it">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liang Xu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/09/semi-supervised-Learning-Deep-Generative-Model/" class="post-title-link" itemprop="url">semi-supervised_Learning_Deep_Generative_Model</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-09 17:38:20" itemprop="dateCreated datePublished" datetime="2019-12-09T17:38:20-05:00">2019-12-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Semi-supervised-Learning-with-Deep-Generative-Models"><a class="header-anchor" href="#Semi-supervised-Learning-with-Deep-Generative-Models"></a>Semi-supervised Learning with Deep Generative Models</h1>
<p>The increasing size of deep learning model with the difficulty if obtaining label information has made semi-supervised learning one of the problems of significant practical importance in modern data analysis.</p>
<p>Generative approaches have thus far been either inflexible, inefficient or non-scalable.</p>
<blockquote>
<ul>
<li>This paper describe a new framework for semi-supervised learning with generative models, employing rich parametric density estimators formed by the fusion of probabilistic modelling and deep neural networks.</li>
<li>this paper show for the first time how variational inference can be brought to bear upon the problem of semi-supervised classification. In particular, we develop a stochastic variational inference algorithm that allows for joint optimization both model and variational parameters, and that is scalable to large datasets.</li>
</ul>
</blockquote>
<h2 id="Deep-Generative-Models-for-Semi-supervised-Learning"><a class="header-anchor" href="#Deep-Generative-Models-for-Semi-supervised-Learning"></a>Deep Generative Models for Semi-supervised Learning</h2>
<p>We are feaced with data that appear as pairs $(\mathbf{X}, \mathbf{Y}) = {(X_1, y_1), … , (X_N, y_N)}$, with the <em>i</em>-th observation $x_i \in \mathbb{R}$ and the corresponding class label $y_i \in {1, … , L}$. Observations will have corresponding latent variables, which we denote by $z_i$. In the semi-supervised learning classification, only a subset of the observations have corresponding class labels; we refer to the exmpirical distribution over the labelled and unlabelled subsets as $\widetilde{p_l}(\mathbf{x}, y)$ and $\widetilde{p_u}(\mathbf{x})$.</p>
<p>We now develop models for semi-supervised learning that exploit generative descriptions of the data to improve upon the classification performance that would be obtained using the labelled data alone.</p>
<h3 id="Latent-feature-discriminative-model-M1"><a class="header-anchor" href="#Latent-feature-discriminative-model-M1"></a>Latent-feature discriminative model(M1)</h3>
<p>A commonly used approach is to construct a model that provides an embedding or feature representation of the data. Using those features, a separate classifier is thereafter trained. By assumption, the embeddings allows for a clustering of related observations in a latent feature space that allows for accurate classification, even with a limited number of labels. Deep generative model of the data can build more robust set of latent features. The generative model used is:</p>
<p>$$ p(z) = \mathcal{N}(\mathbf{z}|\mathbf{0},\mathbf{I})$$<br>
$$ p_\theta(z|x) = p(x; z, \mathbf{\theta})$$<br>
$p_\theta(z|x)$ is a suitable likelihood function whose probability are formulated by nonlinear transformation with parameter $\theta$, and a set of latent variables z. This nonlinear model (parameterized by $\theta$) allows the higher moments of the data to be captured by the density model, and this nonlinear function has been chosen as deep neural networks.</p>
<p>Approximated samples from the posterior distribution over the latent variables p(z|x) are used as features to train as a classifiers to predict the label y, such as a SVM. Using this approach, we can now perform classification in a lower dimensional space(This is very important). The reason for modern deep learning works, they can learn huge parameter space by large amount data. After reduce the dimensionality, during the supervised learning, we only focus on the small classifier parameters in a low dimensional space.</p>
<h3 id="Generative-semi-supervised-model-M2"><a class="header-anchor" href="#Generative-semi-supervised-model-M2"></a>Generative semi-supervised model(M2)</h3>
<p>This is the most important model this paper has been proposed. They proposed a probabilistic model that describes the data as being generated by a latent class variable y in <strong>addition</strong> to a continuous latent variable z. The latent class variable y is also being generated.<br>
$$ p(y) = Cat(y|\pi)$$<br>
$$ p(z) = \mathcal{N}(\mathbf{z}|\mathbf{0},\mathbf{I})$$<br>
$$ p_{\theta}(\mathbf{x} | y,z) = f(\mathbf{x}; y, \mathbf{z},\mathbf{\theta})$$<br>
where $Cat(y|\pi)$ is the multinomial distribution, the class labels $y$ are treated as latent variables if no class label is available and z are additional latent variables. The latent variables are marginally independent and allow us to separate the class specification. As before, $f(\mathbf{x}| y, \mathbf{z},\mathbf{\theta})$ is a suitable likelihood function, parameterised by a non-linear transformation of the latent variables (the decoder).</p>
<blockquote>
<p><strong>Since most labels <em>y</em> are unobserved, we integrate over the class of any unlabelled data during the inference process, thus performing classification as inference. Prediction for any missing labels are obtained from the inferred posterior distribution $p_{\theta}(y|\mathbf{x})$. This model can also be seen as a hybrid continuous-discrete mixture model where the different mixture components share parameters.</strong></p>
</blockquote>
<h3 id="Stacked-generative-semi-supervised-model-M1-M2"><a class="header-anchor" href="#Stacked-generative-semi-supervised-model-M1-M2"></a>Stacked generative semi-supervised model(M1 + M2)</h3>
<p>We can combine these two approaches by first learning a new latent representation $z_1$ using the generative model from M1, and subsequently learning a generative semi-supervised model M2, using embeddings from $z_1$ instead of the raw data <strong>x</strong>.</p>
<blockquote>
<p><strong>The result is a deep generative model with tow layers of stochastic variables</strong><br>
$$p_{\theta}(\mathbf{x}, y,\mathbf{z_{1}}, \mathbf{z_{2}}) = p(y)p(\mathbf{z_{2}})p_{\theta}(\mathbf{z_{1}}|y, \mathbf{z_{2}})p_{\theta}(\mathbf{x}|\mathbf{z_{1}})$$<br>
where the priors $$p(y)$$ and $$p(z_{2})$$ equal those of y and z above,and both $$p_{\theta}(\mathbf{x}|\mathbf{z_{1}})$$ and $$p_{\theta}(\mathbf{z_{1}} | y, \mathbf{z_{2}})$$ are parameterized as deep neural networks.</p>
</blockquote>
<h2 id="3-Scalable-Variational-Inference"><a class="header-anchor" href="#3-Scalable-Variational-Inference"></a>3. Scalable Variational Inference</h2>
<h3 id="3-1-Lower-Bound-Objective"><a class="header-anchor" href="#3-1-Lower-Bound-Objective"></a>3.1 Lower Bound Objective</h3>
<p>For all the models described, we introduce a fixed-form distribution $q_{\phi}(z|x)$ with parameters $\phi$ that approximates the true posterior distribution $p(z|x)$. We then follow the variational principle to derive a lower bound on the marginal likelihood of the model – this bound forms our objective function and ensures that our approximate posterior is as close as possible to the true posterior.</p>
<p>We construct the approximate posterior distribution $q_{\phi}(.)$ as an inference or recognition model. Using an inference network, we avoid the need to compute per data point variational parameters, but can instead compute a set of global variational parameters $\phi$</p>
<p>An inference network is introduced for all latent variables, and we parameterise them as deep neural networks whose outputs from the parameters of the distribution $q_{\phi}(.)$.</p>
<blockquote>
<ul>
<li>For the latent-feature discriminative model (M1), we use a Gaussian inference network $q_{\phi}(\mathbf{z}|\mathbf{x})$ for the latent variable $\mathbf{z}$.</li>
<li>For the generative semi-supervised model(M2), we introduce an inference model fro each of the latent variables $\mathbf{z}$ and $y$, which we assume has a factorised from:<br>
$q_{\phi}(\mathbf{z}, y|\mathbf{x}) = q_{\phi}(\mathbf{z}|\mathbf{x})q_{\phi}(y|\mathbf{x})$ specified as Gaussian and multinomial distribution respectively.</li>
</ul>
</blockquote>
<p>$$M1: q_{\phi}(\mathbf{z}|\mathbf{x}) = \mathcal{N}(\mathbf{z}|\mathbf{\mu_{\phi}}(\mathbf{x}), diag(\mathbf{\sigma_{\phi}^{2}}(\mathbf{x}))),$$<br>
$$M2: q_{\phi}(\mathbf{z}|y, \mathbf{x}) = \mathcal{N}(\mathbf{z}|\mu_{\phi}(y, \mathbf{x}), diag() diag(\mathbf{\sigma_{\phi}^{2}}(\mathbf{x}));$$<br>
$$q_{\phi}(y|\mathbf{x}) = Cat(y|\mathbf{\pi}_{\phi}(\mathbf{x}))$$</p>
<p>where:</p>
<blockquote>
<p>$\mathbf{\sigma}<em>{\phi}(\mathbf{x})$ is a vector of standard deviations<br>
$\mathbf{\pi}</em>{\phi}(\mathbf{x})$ is a probability vector</p>
</blockquote>
<h4 id="3-1-1-Latent-Feature-Discriminative-Model-Objective"><a class="header-anchor" href="#3-1-1-Latent-Feature-Discriminative-Model-Objective"></a>3.1.1 Latent Feature Discriminative Model Objective</h4>
<p>For this model, the variational bound $\mathcal{J}(x)$ on the marginal likelihood for a single data point is:<br>
$$\log{p_{\theta}}(\mathbf{x}) \geq \mathbb{E}<em>{q</em>{\theta}(\mathbf{z}|\mathbf{x})}[\log{p_{\theta}(\mathbf{x}|\mathbf{z})}] - KL[q_{\phi}(\mathbf{z}|\mathbf{x})||p_{\theta}(\mathbf{z})] = -\mathcal{J}(x)$$</p>
<p>The inference M1 network is used during training of the model using both the labelled and unlabelled data set. This approximate posterior is then used as a feature extractor for the labelled data set, and the features used for training the classifier.</p>
<h4 id="3-1-2-Generative-Semi-supervised-Model"><a class="header-anchor" href="#3-1-2-Generative-Semi-supervised-Model"></a>3.1.2 Generative Semi-supervised Model</h4>
<p>M2 model in our model. For this model, we have to cases to consider. In the first case, the label corresponding to a data point is observed and variational bounding is simply extension of previous loss function.<br>
$$\log{p_{\theta}(\mathbf{x}, y)} \geq  \mathbb{E}<em>{q</em>{\theta}(\mathbf{z}|\mathbf{x}, y)}[\log{p_{\theta}}(\mathbf{x}|y, \mathbf{z}) + \log{p_{\theta}(y)}+\log{p(\mathbf{z})} - \log{q_{\phi}(\mathbf{z}|\mathbf{x}, y)}] = -\mathcal{L}(\mathbf{x}, y)$$</p>
<p>For the case where the label is missing, it is treated as a latent variable over which we perform posterior inference and the resulting bound for handling data points with an unobserved label $y$ is:</p>
<p>$$<br>
\begin{aligned}<br>
\log{p_{\theta}(\mathbf{x}, y)} &amp;\geq  \mathbb{E}<em>{q</em>{\theta}(\mathbf{z}, y|\mathbf{x})}[\log{p_{\theta}(\mathbf{x}|y, \mathbf{z}) + \log{p_{\theta}(y)}+\log{p(\mathbf{z})} - \log{q_{\phi}(\mathbf{z}|\mathbf{x}, y)}}] \<br>
&amp;= \sum_{y}q_{\phi}(y|\mathbf{x})(-\mathcal{L}(\mathbf{x}, y) + \mathcal{H}(q_{\phi}(y|\mathbf{x}))) \<br>
&amp;=-\mathcal{U}(x)<br>
\end{aligned}<br>
$$</p>
<p>The bound on the marginal likelihood for the entire data set is now:<br>
$$<br>
\mathcal{J} = \sum_{(\mathbf{x}, y) \sim \widetilde{p_l}}\mathcal{L}(\mathbf{x},y) + \sum_{\mathbf{x} \sim \widetilde{p_u}} \mathcal{U}(\mathbf{x})<br>
$$</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/04/02-why-Do-We-need-Taking-Care-of-Performance/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liang Xu">
      <meta itemprop="description" content="This is the place for Liang to make any notes if he feels like it">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liang Xu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/04/02-why-Do-We-need-Taking-Care-of-Performance/" class="post-title-link" itemprop="url">02 Why do we care about performance?</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-04 23:40:18" itemprop="dateCreated datePublished" datetime="2019-12-04T23:40:18-05:00">2019-12-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Software engineer or programmer? what is the difference? Performance optimization and capacity efficiency sounds very important, but why do I need to care about this?<br>
In this post, I will talk about why you need to care about performance when you called yourself a software engineer.</p>
<h2 id="How-to-define-performance"><a class="header-anchor" href="#How-to-define-performance"></a>How to define performance</h2>
<p>There are several indexs to measure the performance.</p>
<ul>
<li>Throughput : throughput performance is often expressed as transactions per second, or TPS.</li>
<li>Service latency : service latency is the delay between a client request and a cloud service provider’s response.</li>
<li>Scalability: System easy to scale by adding more computing resources, for example adding more meory or CPUs.</li>
<li>Resource Utilization: computing resource for a unit of request.(CPU memory).</li>
<li>Reliability, not going to discussed int his serious.</li>
</ul>
<p>What we want are:</p>
<ul>
<li>Throughput: High</li>
<li>Service latency: Low</li>
<li>Scalability: Easy</li>
<li>Resource Utilization: Less</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i, j;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> x[<span class="number">4000</span>][<span class="number">4000</span>]; </span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">40000</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4000</span>; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        x[j][i] = i + j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i, j;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> x[<span class="number">4000</span>][<span class="number">4000</span>]; </span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">40000</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4000</span>; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        x[j][i] = i + j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Do you know the difference between those two coding styles? Which one is faster? It depends, depends on how the system saves the 2 dimension array. If this is c++ code(it is), the performance would make much difference because of the memory hierarchy.</p>
<p>Ok, there will be several examples related to performance, I am not going to list everything, just let you know why you need to care about performance.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/04/01-Coding-Performance/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liang Xu">
      <meta itemprop="description" content="This is the place for Liang to make any notes if he feels like it">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liang Xu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/04/01-Coding-Performance/" class="post-title-link" itemprop="url">01 coding is inevitable performance is optional</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-04 22:38:40" itemprop="dateCreated datePublished" datetime="2019-12-04T22:38:40-05:00">2019-12-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Is this true? Certainly not. When we thinking about coding, performance is the most important concept in our minds.</p>
<h2 id="Winning-depends-on-performance"><a class="header-anchor" href="#Winning-depends-on-performance"></a>Winning depends on performance</h2>
<p>Performance optimization and capacity efficiency are the most important topics for the IT company. It determines who can provide a better service.</p>
<p>Thinking in performance not only means you need to think in terms of algorithm, but also you need to know how the system works and the system architecture. For example, SSD as a flash cache lets the system have another level of memory, what is memory mountain, what is cache-oblivious algorithm whey they are useful.</p>
<p>All performance topics will be discussed in this TAG: HighPerformance.</p>
<p>I used to do some research in this topic, graph computing. There will be some posts talk about graph computing also. Thanks for reading this.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/04/01-Inception-Versions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liang Xu">
      <meta itemprop="description" content="This is the place for Liang to make any notes if he feels like it">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liang Xu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/04/01-Inception-Versions/" class="post-title-link" itemprop="url">Inception Versions</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-04 16:03:38" itemprop="dateCreated datePublished" datetime="2019-12-04T16:03:38-05:00">2019-12-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Inception-versions"><a class="header-anchor" href="#Inception-versions"></a>Inception versions</h3>
<p>In this section, I will compare the difference version of inception. Explain how they think, what kinds of problem they what to solve.</p>
<h4 id="Inception-v1"><a class="header-anchor" href="#Inception-v1"></a>Inception v1</h4>
<p>The first version of inception is based on the computation efficiency. As we know that, modern computing system are not good at sparse matrix computation, lost of the resource are wasted due to the sparsity. Also, our deep convolutional neural network are a sparse matrix multiplication. So the first idea is to approximate the dense matrix multiplication by using several convolutional together. The original words are “The main idea of the Inception architecture is based on finding out how an optimal local sparse structure in a convolutional vision network can be approximated and covered by readily available dense components”.<br>
The original inception module are build based on several different convolutional filters 1x1, 3x3 ,5x5, and a pooling layer.<br>
<img src="images/01_inception_01.png" alt=""></p>
<p>However, the number of 5x5 filters are very big compared with 3x3. Also, when adding the pooling units, the merging of their number of output filters equals to the number of filters in the previous stage. So, in the concatenation layer, the input size from the pooling layer concatenated convolutional layers make the output inevitable increase in the number of outputs form state to state. This is the reason they propose the second version.</p>
<h5 id="Inception-V2"><a class="header-anchor" href="#Inception-V2"></a>Inception V2</h5>
<p>Inception V2 module is with the demension reduction with 1X1 filter. 1x1 filter are applying dimension reductions and projections wherever the computational requeiremnts would increase too much otherwise.</p>
<p><img src="images/01_inception_02.png" alt=""></p>
<p>The 1x1 convolutions are used tp compute reductions before the expensive 3x3 and 5x5 convolutions. They also include the use of rectified linear activation which makes them dual purpose.</p>
<h4 id="Inception-V3"><a class="header-anchor" href="#Inception-V3"></a>Inception V3</h4>
<p>Inception V3 is proposed by another paper. It trying to reduce the filter form nxn to 1xn. In this module, they studied the relation of filter size and how to optimize them. For example, they trying to use 2 3x3 filters instead of 1 5*5. Like the filter below.<br>
<img src="images/01_inception_03.png" alt=""><br>
<img src="images/01_inception_03_2.png" alt=""></p>
<h4 id="Inception-V4"><a class="header-anchor" href="#Inception-V4"></a>Inception V4</h4>
<p>Inception V4 also proposed by another paper. The inception of v4’s idea came from ResNet. In that paper, they proposed lots of paper talked about different versions of the neural network connections, especially how to do something similar with the ResNet.<br>
<img src="images/01_inception_04.png" alt=""></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/03/smart-pointer-implementation-cpp-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liang Xu">
      <meta itemprop="description" content="This is the place for Liang to make any notes if he feels like it">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liang Xu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/03/smart-pointer-implementation-cpp-02/" class="post-title-link" itemprop="url">CPP_02 Smart Pointer Implementation</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-12-03 00:17:02" itemprop="dateCreated datePublished" datetime="2019-12-03T00:17:02-05:00">2019-12-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Smart-pointer-in-C"><a class="header-anchor" href="#Smart-pointer-in-C"></a>Smart pointer in C++</h2>
<p>From the previous post, there is a shape_wrapper class which has basic idea of smart pointer.<br>
In this post, I will discuss hwo can we change the shape_wrapper to a smart pointer.</p>
<h3 id="Last-time-shape-wrapper"><a class="header-anchor" href="#Last-time-shape-wrapper"></a>Last time shape_wrapper</h3>
<p>The shape_wrapper for last time</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">shape_wrapper</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">shape_wrapper</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    shape* ptr = <span class="literal">nullptr</span>)</span></span></span><br><span class="line">    : ptr_(ptr) &#123;&#125;</span><br><span class="line">  ~shape_wrapper()</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">delete</span> ptr_;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">shape* <span class="title">get</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  shape* ptr_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>This class have some basic idea of smartpointer, it can release the object when its exceed the boundary. Hoever, something is missing.</p>
<ol>
<li>This class only works for shape class.</li>
<li>This class is not woking like a pointe,</li>
<li>copy constructor and copy assiagnment is not defined.</li>
</ol>
<h3 id="template"><a class="header-anchor" href="#template"></a>template</h3>
<p>We can use template for this class, and makes it used for other types.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">smart_ptr</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">smart_ptr</span><span class="params">(T* ptr = <span class="literal">nullptr</span>)</span></span></span><br><span class="line">    : ptr_(ptr) &#123;&#125;</span><br><span class="line">  ~smart_ptr()</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">delete</span> ptr_;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">T* <span class="title">get</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  T* ptr_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Compare with the shape_wrapper,we can declare the template<typename T>, then we change the type ‘shape’ to template T in the code body. For the previous case, shape_wraper = smart_ptr<shape>.</p>
<p>For now, this smart_ptr have some basic RAII function, it can release the resource when the resource out of its working boundary. However, something is missing.</p>
<ul>
<li>it can not use * to dereference resource.</li>
<li>It can not use -&gt; to point to the object member.</li>
<li>It can not use when treat it like a boolean operator.<br>
We can add some member function to solve this issue.</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">smart_ptr</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ...</span><br><span class="line">    T&amp; <span class="keyword">operator</span>*() <span class="keyword">const</span>&#123; <span class="keyword">return</span> *ptr_; &#125;</span><br><span class="line">    T* <span class="keyword">operator</span>-&gt;() <span class="keyword">const</span>&#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">bool</span><span class="params">()</span> <span class="keyword">const</span></span>&#123; <span class="keyword">return</span> ptr_; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Copy-constructor-and-assignment"><a class="header-anchor" href="#Copy-constructor-and-assignment"></a>Copy constructor and assignment</h3>
<p>we can call the copy constructor and assignment constructor as copy, and this is a little bit complicated compare with the previous case. How to implement is not a problem, but how to define it would be carefully defined. For example, the following case:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">smart_ptr&lt;shape&gt; ptr1&#123;create_shape(shape_type::circle)&#125;; <span class="comment">// copy </span></span><br><span class="line">smart_ptr&lt;shape&gt; ptr2&#123;ptr1&#125;; <span class="comment">// copy</span></span><br></pre></td></tr></table></figure>
<p>For the second case, it should report a error during compiling or we need to find a better way to define this? Let us see how can we do this:<br>
The simplest case is prohibit the copy constructor and copy assignment constructor.(the difference will be explained at the end of this article). The code can be programmed as following:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">smart_ptr</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ...</span><br><span class="line">    smart_ptr(<span class="keyword">const</span> smart_ptr&amp;) = <span class="keyword">delete</span>; <span class="comment">// copy constructor</span></span><br><span class="line">    smart_ptr&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> smart_ptr&amp;) = <span class="keyword">delete</span>; <span class="comment">// copy assignment constrctor</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Prohibit those two constructor is very easy, it solved one type error. Otherwise, the code -&gt; smart_ptr<shape> ptr2{ptr1} will become undefined behavior during runtime, it will release the resource twice and crash the program, but it is find during the complication.</p>
<p>Can we copy the object during the copy smart_ptr? No, nobody will do this, the propose of smart_ptr is reduce the wrapped object copy times. And our point type is shape, but the real pointer should be circle or triangle object. In c++ there is no such a clone method like Java, for common case, there is no other way you can construct a derived class base on a parents type.</p>
<p>Can we swap the owner ship of the smart pointer? Let us look at the code below:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">smart_ptr</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ...</span><br><span class="line">    smart_ptr(smart_ptr&amp; other) <span class="comment">// copy constructor</span></span><br><span class="line">    &#123;</span><br><span class="line">        ptr_ = other.release(); </span><br><span class="line">    &#125;</span><br><span class="line">    smart_ptr&amp; <span class="keyword">operator</span>=(smart_ptr&amp; rhs) <span class="comment">// copy assignment constructor</span></span><br><span class="line">    &#123;</span><br><span class="line">        smart_ptr(rhs).swap(*<span class="keyword">this</span>); </span><br><span class="line">        <span class="comment">// use the copy constructor to build a tmp object based on the rhs</span></span><br><span class="line">        <span class="comment">// then swap the ownership of this tmp object with the memebr</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// define the release function</span></span><br><span class="line">    <span class="function">T* <span class="title">release</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        T* ptr = ptr_;</span><br><span class="line">        ptr_ = <span class="literal">nullptr</span>; <span class="comment">// pointed to a null ptr</span></span><br><span class="line">        <span class="keyword">return</span> ptr; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// define the swap fucntion</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(smart_ptr&amp; rhs)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">using</span> <span class="built_in">std</span>::swap; </span><br><span class="line">        swap(ptr_, rhs.ptr_); </span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>During the copy, we can call other.release() release the ownership of the object. And during the copy assignment, we can swap the ownership with the temporary object during the copy construction (the first line in the copy assignment constructor).<br>
If you learn something like</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span> != &amp;rhs) then ...</span><br></pre></td></tr></table></figure>
<p>this is redundant, and not safe. If something wrong happened during the assignment and through out something, the original object might be already broken, and it is not a complete object anymore.</p>
<p>This is common case to make sure the strong exception safety. Copy assignment has two steps, the first step is copy then swap, and the exception can only happen in the first step. And if the exception is in the first step, there will be on affect on the <strong>this object</strong>(because during the copy <strong>this</strong> is intact). So weather the copy is successful or not, the result only has two types, sucsssfulled assigned or not, and both of the types are not going to destroy the original object.</p>
<p>However, our smart_ptr works in some situation, but it is very easy to make mistake. Because, after you assign the object, the original object loss the ownership which is very easy for programmer to make mistakes.</p>
<p>This is how the auto_ptr define in c<ins>98, and it is deleted from std in c</ins>17.</p>
<h3 id="“Move”-pointer"><a class="header-anchor" href="#“Move”-pointer"></a>“Move” pointer</h3>
<p>Let’s see how can we use move to optimize the start_ptr.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">smart_ptr</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ...</span><br><span class="line">    smart_ptr(smart_ptr&amp;&amp; other)</span><br><span class="line">    &#123;</span><br><span class="line">        ptr_ = other.release();</span><br><span class="line">    &#125;</span><br><span class="line">    smart_ptr&amp; <span class="keyword">operator</span>=(smart_ptr rhs)</span><br><span class="line">    &#123;</span><br><span class="line">        rhs.swap(*<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We changed two places:</p>
<ol>
<li>In the copy constructor I have changed the smart_ptr&amp; tp smart_ptr&amp;&amp;; So this is not copy constructor anymore, this is move constructor.</li>
<li>In the assignment constructor the input change from smart_ptr&amp; to smart_ptr, this</li>
</ol>
<p>is copied version compared with the previous one. We do not need to generate a temporary object. For right now, the assignment is a copy or move totally depends on the <strong>constructor using copy constructor or move constructor</strong>. The result is shown below:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">smart_ptr&lt;shape&gt; ptr1&#123;create_shape(shape_type::circle)&#125;; </span><br><span class="line">smart_ptr&lt;shape&gt; ptr2&#123;ptr1&#125;;   <span class="comment">// complication error. ptr1 will loss the ownership</span></span><br><span class="line">smart_ptr&lt;shape&gt; ptr3; </span><br><span class="line">ptr3 = ptr1;                   <span class="comment">// complication error. ptr1 will loss the ownership</span></span><br><span class="line">ptr3 = <span class="built_in">std</span>::move(ptr1);        <span class="comment">// OK, programmer knows it will loss the ownership</span></span><br><span class="line">smart_ptr&lt;shape&gt; ptr4&#123;<span class="built_in">std</span>::move(ptr3)&#125;; <span class="comment">// OK</span></span><br></pre></td></tr></table></figure>
<p>This is like the unique_ptr.</p>
<h3 id="derived-pointer-type-change-to-father-type"><a class="header-anchor" href="#derived-pointer-type-change-to-father-type"></a>derived pointer type change to father type</h3>
<p>There is a small defect, for the above case. For example, circle* can directly change to shape* according to hwo circle defined. However, smart_ptr<circle> can not change to smart_ptr<shape>.<br>
We can add some template code to make it works. For our implement, we can add a constructor.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">smart_ptr(smart_ptr&lt;U&gt;&amp;&amp; other)</span><br><span class="line">&#123;</span><br><span class="line">    ptr_ = other.release(); </span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">By doing <span class="keyword">this</span>, smart_ptr&lt;circle&gt; can move to smart_ptr&lt;shape&gt;. However, we have a better way to <span class="keyword">do</span> <span class="keyword">this</span>, will discussed in the following chapter. </span><br><span class="line"></span><br><span class="line">### Reference Counting</span><br><span class="line"><span class="built_in">unique_ptr</span> is a safe smart pointer. However, one object can only has one unique pointer <span class="keyword">not</span> works <span class="keyword">for</span> all cases. For some cases, we need to define an object pointed by several objects, <span class="keyword">and</span> when no one point to the object, its will call the destructor to <span class="keyword">delete</span> itself. This is the basic idea <span class="keyword">for</span> share_ptr. </span><br><span class="line"></span><br><span class="line">So different <span class="built_in">shared_ptr</span> can share one object, <span class="keyword">and</span> count how many pointer pointed to it. Our implement:</span><br><span class="line">```cpp</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">shared_count</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    shared_count();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add_count</span><span class="params">()</span></span>; </span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">reduce_count</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">get_count</span><span class="params">()</span> <span class="keyword">const</span></span>; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>This shared_count has a constructor and 3 methods.</p>
<ol>
<li>add counter.</li>
<li>reduce counter.</li>
<li>get the counter.<br>
Add counter no return needed, and reduce counter need to return the counter. The calling method can check whether it is the last one pointed to this object. Now, we are not going to implement a multi-tread version, we are using a simplified version for single thread version only.</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">shared_count</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>: </span><br><span class="line">    shared_count() : count_(<span class="number">1</span>) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add_count</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ++count_;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">reduce_count</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        --count_;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">get_count</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count_;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>: </span><br><span class="line">    <span class="keyword">long</span> count_; </span><br><span class="line">&#125;;</span><br><span class="line">``` </span><br><span class="line">Now we can revise our smart pointer, constructor <span class="keyword">and</span> destructor <span class="keyword">and</span> <span class="keyword">private</span> member functions. </span><br><span class="line">```cpp</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">smart_ptr</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>: </span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">smart_ptr</span><span class="params">(T* ptr = <span class="literal">nullptr</span>)</span></span></span><br><span class="line">    : ptr_(ptr)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(ptr)</span><br><span class="line">        &#123;</span><br><span class="line">            shared_count_ = <span class="keyword">new</span> shared_count(); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ~smart_ptr()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ptr_ &amp;&amp; </span><br><span class="line">           !shared_count_-&gt;reduce_count())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">delete</span> ptr_;</span><br><span class="line">            <span class="keyword">delete</span> shared_count_;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>: </span><br><span class="line">    T* ptr_;</span><br><span class="line">    shared_count* shared_count_; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Compare with the previous version, the constructor construct a shared_conut. And the destructor will check the ptr_ empty or not. If it is not empty reduce the count, and if the reduce_count return a 0, then delete the ptr_ and shared_count_ object.<br>
We need a new swap function.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(smart_ptr&amp; rhs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="built_in">std</span>::swap; </span><br><span class="line">    swap(ptr_, rhs.ptr_);</span><br><span class="line">    swap(shared_count_, rhs.shared_count_); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">smart_ptr(<span class="keyword">const</span> smart_ptr&amp; other) <span class="comment">// copy constructor</span></span><br><span class="line">&#123;</span><br><span class="line">    ptr_ = other.ptr_;</span><br><span class="line">    <span class="keyword">if</span>(ptr_)</span><br><span class="line">    &#123;</span><br><span class="line">        other.shared_count_ -&gt; add_count(); <span class="comment">// add a count to the previous object </span></span><br><span class="line">        shared_count_ = other.shared_count_;</span><br><span class="line">        <span class="comment">// shared_count_ is a common object across all the object</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">smart_ptr(<span class="keyword">const</span> smart_ptr&amp; other)</span><br><span class="line">&#123;</span><br><span class="line">    ptr_ = other.ptr_;</span><br><span class="line">    <span class="keyword">if</span> (ptr_) <span class="comment">// ptr_ is not nullptr</span></span><br><span class="line">    &#123;</span><br><span class="line">        other.shared_count_ -&gt; add_count();</span><br><span class="line">        shared_count_ = other.shared_count_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">smart_ptr(smart_ptr&lt;U&gt;&amp;&amp; other) <span class="comment">// move constructor, transfer the ownership</span></span><br><span class="line">&#123;</span><br><span class="line">    ptr_ = other.ptr_; </span><br><span class="line">    <span class="keyword">if</span> (ptr_)</span><br><span class="line">    &#123;</span><br><span class="line">        shared_count_ = other.shared_count_;</span><br><span class="line">        other.ptr_    = <span class="literal">nullptr</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>For copy, if the pointer is not empty, we should add 1 to the counter class, and copy the counter class pointer. For move, we do not need to change the reference counting, just change the original object pointer to nullptr.<br>
However, the code above have some complication error.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fatal error: ‘ptr_’ is a private member of ‘smart_ptr&lt;circle&gt;’</span><br><span class="line">``` </span><br><span class="line">The reason is that, the template are not friend between each other, so it can not access the ptr_ and shared_count_. we need to <span class="built_in">declare</span> the friendship </span><br><span class="line"></span><br><span class="line">```cpp</span><br><span class="line">template&lt;typename U&gt;</span><br><span class="line">friend class smart_ptr</span><br></pre></td></tr></table></figure>
<p>For previous case, we need to release the ownership manually. After the reference counting, we can release the ownership by counting. We need to add one more functon to achieve this.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">use_count</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ptr_) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> shared_count_ -&gt; get_count();</span><br><span class="line">        <span class="comment">// in this case, the return value should not 0; </span></span><br><span class="line">    &#125; <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Cast-the-pointer-type"><a class="header-anchor" href="#Cast-the-pointer-type"></a>Cast the pointer type</h3>
<p>In C++ there are 3 cases for type change:</p>
<ul>
<li>static_cast</li>
<li>reinterpret_cast</li>
<li>const_cast</li>
<li>dynamic_cast<br>
code</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">smart_ptr(<span class="keyword">const</span> smart_ptr&lt;U&gt;&amp; other, T* ptr)</span><br><span class="line">&#123;</span><br><span class="line">    ptr_ = ptr; </span><br><span class="line">    <span class="keyword">if</span> (ptr_)</span><br><span class="line">    &#123;</span><br><span class="line">        other.shared_count_ -&gt; add_count();</span><br><span class="line">        shared_count_ = other.shared_count_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now we have the template for changing the types.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt;</span><br><span class="line">smart_ptr&lt;T&gt; dynamic_pointer_cast(<span class="keyword">const</span> smart_ptr&lt;U&gt;&amp; other)</span><br><span class="line">&#123;</span><br><span class="line">    T* ptr = <span class="keyword">dynamic_cast</span>&lt;T*&gt;(other.get); </span><br><span class="line">    <span class="keyword">return</span> smart_ptr&lt;T&gt;(other, ptr); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Whole-Code"><a class="header-anchor" href="#Whole-Code"></a>Whole Code</h3>
<p>Now we have everything we need, then we can test the code.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::swap; </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">shape</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~shape() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">circle</span> :</span> <span class="keyword">public</span> shape</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~circle() </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"~circles"</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">shared_count</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    shared_count() <span class="keyword">noexcept</span></span><br><span class="line">     : count_(<span class="number">1</span>) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add_count</span><span class="params">()</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ++count_; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">reduce_count</span><span class="params">()</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> --count_;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">get_count</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count_; </span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">long</span> count_; </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">smart_ptr</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>: </span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt; <span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">smart_ptr</span>;</span> </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// constructor</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">smart_ptr</span><span class="params">(T* ptr = <span class="literal">nullptr</span>)</span></span></span><br><span class="line">    : ptr_(ptr)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ptr)</span><br><span class="line">        &#123;</span><br><span class="line">            shared_count_ = <span class="keyword">new</span> shared_count();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// destructor</span></span><br><span class="line">    ~smart_ptr()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ptr_ &amp;&amp; !shared_count_-&gt;reduce_count())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">delete</span> ptr_;</span><br><span class="line">            <span class="keyword">delete</span> shared_count_;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// copy constructor</span></span><br><span class="line">    smart_ptr(<span class="keyword">const</span> smart_ptr&amp; other)</span><br><span class="line">    &#123;</span><br><span class="line">        ptr_ = other.ptr_;</span><br><span class="line">        <span class="keyword">if</span>(ptr_)</span><br><span class="line">        &#123;</span><br><span class="line">            other.shared_count_-&gt; add_count();</span><br><span class="line">            shared_count_ = other.shared_count_; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">    smart_ptr(<span class="keyword">const</span> smart_ptr&lt;U&gt;&amp; other) <span class="keyword">noexcept</span></span><br><span class="line">    &#123;</span><br><span class="line">        ptr_ = other.ptr_;</span><br><span class="line">        <span class="keyword">if</span>(ptr_)</span><br><span class="line">        &#123;</span><br><span class="line">            other.shared_count_-&gt; add_count();</span><br><span class="line">            shared_count_ = other.shared_count_; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">    smart_ptr(smart_ptr&lt;U&gt;&amp;&amp; other) <span class="keyword">noexcept</span></span><br><span class="line">    &#123;</span><br><span class="line">        ptr_ = other.ptr_;</span><br><span class="line">        <span class="keyword">if</span> (ptr_)</span><br><span class="line">        &#123;</span><br><span class="line">            shared_count_ = other.shared_count_;</span><br><span class="line">            other.ptr_ = <span class="literal">nullptr</span>; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// use this when using the cast fucntion</span></span><br><span class="line">    <span class="comment">// constructor, do not need to define the return type</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">    smart_ptr(<span class="keyword">const</span> smart_ptr&lt;U&gt;&amp; other, T* ptr) <span class="keyword">noexcept</span></span><br><span class="line">    &#123;</span><br><span class="line">        ptr_ = other.ptr_;</span><br><span class="line">        <span class="keyword">if</span>(ptr_)</span><br><span class="line">        &#123;</span><br><span class="line">            other.shared_count_-&gt; add_count();</span><br><span class="line">            shared_count_ = other.shared_count_; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    smart_ptr&amp;</span><br><span class="line">    <span class="keyword">operator</span>=(smart_ptr rhs) <span class="keyword">noexcept</span></span><br><span class="line">    &#123;</span><br><span class="line">        rhs.swap(*<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T* <span class="title">get</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ptr_;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">use_count</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ptr_)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> shared_count_-&gt;get_count(); </span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(smart_ptr&amp; rhs)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">using</span> <span class="built_in">std</span>::swap;</span><br><span class="line">        swap(ptr_, rhs.ptr_);</span><br><span class="line">        swap(shared_count_, rhs.shared_count_); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// operators </span></span><br><span class="line">    T&amp; <span class="keyword">operator</span>*() <span class="keyword">const</span> <span class="keyword">noexcept</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> *ptr_;</span><br><span class="line">    &#125;</span><br><span class="line">    T* <span class="keyword">operator</span>-&gt;() <span class="keyword">const</span> <span class="keyword">noexcept</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ptr_;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">bool</span><span class="params">()</span> <span class="keyword">const</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ptr_;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T* ptr_;</span><br><span class="line">    shared_count* shared_count_; </span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(smart_ptr&lt;T&gt;&amp; lhs, </span></span></span><br><span class="line"><span class="function"><span class="params">          smart_ptr&lt;T&gt;&amp; rhs)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    lhs.swap(rhs); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt;</span><br><span class="line">smart_ptr&lt;T&gt; static_pointer_cast(</span><br><span class="line">    <span class="keyword">const</span> smart_ptr&lt;U&gt;&amp; other) <span class="keyword">noexcept</span></span><br><span class="line">&#123;</span><br><span class="line">    T* ptr = <span class="keyword">static_cast</span>&lt;T*&gt;(other.get()); </span><br><span class="line">    <span class="keyword">return</span> smart_ptr&lt;T&gt;(other, ptr); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt;</span><br><span class="line">smart_ptr&lt;T&gt; reinterpret_pointer_cast(</span><br><span class="line">    <span class="keyword">const</span> smart_ptr&lt;U&gt;&amp; other) <span class="keyword">noexcept</span></span><br><span class="line">&#123;</span><br><span class="line">    T* ptr = <span class="keyword">reinterpret_cast</span>&lt;T*&gt;(other.get()); </span><br><span class="line">    <span class="keyword">return</span> smart_ptr&lt;T&gt;(other, ptr); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt;</span><br><span class="line">smart_ptr&lt;T&gt; const_pointer_cast(</span><br><span class="line">    <span class="keyword">const</span> smart_ptr&lt;U&gt;&amp; other) <span class="keyword">noexcept</span></span><br><span class="line">&#123;</span><br><span class="line">    T* ptr = <span class="keyword">const_cast</span>&lt;T*&gt;(other.get());</span><br><span class="line">    <span class="keyword">return</span> smart_ptr&lt;T&gt;(other, ptr); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt;</span><br><span class="line">smart_ptr&lt;T&gt; dynamic_pointer_cast(</span><br><span class="line">    <span class="keyword">const</span> smart_ptr&lt;U&gt;&amp; other) <span class="keyword">noexcept</span></span><br><span class="line">&#123;</span><br><span class="line">    T* ptr = <span class="keyword">dynamic_cast</span>&lt;T*&gt;(other.get()); </span><br><span class="line">    <span class="keyword">return</span> smart_ptr&lt;T&gt;(other, ptr); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  smart_ptr&lt;circle&gt; ptr1(<span class="keyword">new</span> circle());</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"use count of ptr1 is %ld\n"</span>,</span><br><span class="line">         ptr1.use_count());</span><br><span class="line">  smart_ptr&lt;shape&gt; ptr2;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"use count of ptr2 was %ld\n"</span>,</span><br><span class="line">         ptr2.use_count());</span><br><span class="line">  ptr2 = ptr1;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"use count of ptr2 is now %ld\n"</span>,</span><br><span class="line">         ptr2.use_count());</span><br><span class="line">  <span class="keyword">if</span> (ptr1) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"ptr1 is not empty"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We will discuss the smart pointe later, thanks for reading this. I will try my best to post more technique blog.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Liang Xu</p>
  <div class="site-description" itemprop="description">This is the place for Liang to make any notes if he feels like it</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">37</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liang Xu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.5.0
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>













  

  
      
<script type="text/x-mathjax-config">
    MathJax.Ajax.config.path['mhchem'] = '//cdn.jsdelivr.net/npm/mathjax-mhchem@3';

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        extensions: ['[mhchem]/mhchem.js'],
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    

  


</body>
</html>
